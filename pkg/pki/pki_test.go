/*
Copyright 2019 GM Cruise LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

	http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/

package pki

import (
	"encoding/json"
	"fmt"
	"io/ioutil"
	"net/http"
	"net/http/httptest"
	"os"
	"strings"
	"testing"

	cfg "github.com/cruise-automation/daytona/pkg/config"
	"github.com/cruise-automation/daytona/pkg/helpers/testhelpers"

	"github.com/stretchr/testify/assert"
)

// nolint: gosec
const (
	testPkiSingleDomainPrivateKey string = `-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEAuaOUdJHtzATZ3ao4+o2rSWQlu9kOwMs1gRjpTTXc454LISve
eQTW/qkdFVu0VoX4+04y7FBN/giAIk3T5zN1QlxVnM7K78w/bZSZzdrOKoJEGpIh
V0kwiZtv+Nekzyw5hJzZqtqNPJARISrWxTf7O7cjiPbNyY5dquUToY2aSDJBzhqz
NRsxM6Syl8wIcM8TBm/Dsq+lJYfGdVevZ4j6UXkATd2wOCnswbzTR3S0VUxdCDnE
6+c4yUt28Qu3SvaFT9OGVXegw5n8G6Dgs/PHyqNQJziBU1uXCFWcUtqcBo9X39BV
4qBvZKXs6b3m4WvG1+Rqadqu+W+dhsjVAfVySwIDAQABAoIBAC2xQMIshQ55hzKT
SnEJW8a1ur/w3jvACMxc2Ffj0RnJdc3VYW4CLfUCpSDzsIC3eyBIECqwXXIQn5FR
/L1kohESbxQopjS93kLXl7/egm5eH+s2WrSEVEkalEX4th00Mngcr0rpfmgQwdab
F7/1VoZNPpbgwKhCvXVp6xoRo47vO91FhG2plAmO/A1X4elIA1rGfnx2x2OQMrXT
QH0yKswN+ZuoTn+2vTWXeoep8DOE8XwcR8fL2ZI9XMg6sXqKMqPdquLF6MVUw3uO
/B12u/fibjzx8o2BaeYIWFRqNinNRGYlTLqFuUSHGhraFXf0shJUcn+g7bcG5U7N
0QWHXoECgYEAwv7NfIbfznFpqM4mrFnS++5ik18jJ796fnbspqqAhAJq967HiDlw
QQMo31fvT54mgSKJZDp5iC6kxpBmi085QT9ZMkT39TTqHObpiuvW2gL8+uak7pQ9
KeAeTqoa/CWSxExhEPFl7fWpV8QCj1xTwXXWzLhGhiY5OoC9PF8UNgsCgYEA87dt
TsCsQijQehhMi/uoXZOF5G+2xSA660/xdua6qs2viGWrhdWaJ3ZTlPuXO8d94+EG
4xyvKfYIMb2rADGz4kGTL1F5WGDoxN9T6hB/rm7BU3gGBS2rlY4hNNuqvwgVaPE/
U+0sq5SXxBNuPXHbUU4Ule6XpTsu9E2Nx/ienMECgYAC+O1a85dfxzzMFPBj+i6M
JpMcGfwoM/QDD38F/11cJclJo0FpYy7B3vF1jhqYxRljKIqdm4KUv9lFKZhWkUuX
IgcTDBgXhcn3zNFMi9HHmvoOPQvQkzPneoIbwt4Mb+ov0dY88uER4ofFTbiYRNkF
/uzaTAjPLK/8o0+/JtfhBwKBgQDJNRRfQh50+HE1e74mi3uy1cpikABauoMqJnP5
b/+IaAuVFisHcRO1pLDYfOWcitRaQDuJYPMUN3UIa8gzftU95Fl5ZVBDMK67ao1C
3qArCHE/UgXWXKAd9ptfokNTN39FhnZ7+YE5npG1ZT1MKSWh+E5ygepclYHsW+LD
x3RbgQKBgQCL6VIDBP+uJzuDajVAOiasUSYx/BK+icUSo/oq6MvFRctvcRDVMv+8
ZxnDXDaDYU88/n3GwMxt2NyHHrr5zPb0zVm1wcVKfplPZ1b6HtNnOuu701/Nqcp+
jKatMksdyonSH0+i/liTKj0nriE643uMuQgVvo4SFx9knSdD/869eg==
-----END RSA PRIVATE KEY-----`

	testPkiMultipleDomainPrivateKey string = `-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEA1Okp878HvyhUOHlhLeVm7k4GTW8UR4+pjjGnoIx7jndk+Teo
Mjm9Fnz8oppb7NIYgpgMn6cQtq3fhWejVFVtMBYKXoNJvMZj5HVEqMi//OFzKtpU
eK90VDwYsASmqmN3EXh7VmpseE6pm9//blf/PJG5nFsSyFbOEavo3Jj/ZZrlCmId
NNaKtn4YTYh1VvE9niB4hS6NEirPuCpTEjsqg/pCfHXIOrsa8+eyEj/hLLtCzGJG
7IFPiT8p5rlxqr5Kh5IrFfqn4gkgorAP/X8qCIRqfW4nFe8oAdcuZhjsvc4r0qwK
OGYMObENonp8a4WvrIBRJEHwSCE37/8VjjoYCQIDAQABAoIBAQDJ8kb6jY15gXUx
A+BrOhZBnvxXYi7oGZoH541JuTZQ0WqTAHmm+iEiPXcbfDIJFNZuuG3w2PP/cjh7
Puwqx8SDQcSgFQNR7RM+1QRE2/VOlUE5ulE5D6LVaxM3kZHMN//uMEs8kkFEc8ho
szSCozDTcJ2PcssD/2ICXP7Ijs5gvakYO1vdsN9+IOzVG8D+BWzqDuFynuv2VFGa
cZdJRJMUJZqNBADhLAdsJFZxylRRv7GT0X5n5BjDM14Fb1P+br9ZpUzSKrydyBwV
qheuoAYe6h+DeL9Rzc8oI8HRYh0+u1N2WrYt0FD9Yirdj4PcQXiddNXwvmZ2rLPK
IZN9EaQBAoGBAPhqBi4unNLQ0YpU6x/omcD21DBfkax6+blQlUEH9cMrsY6U9qVT
BBvyyi20i86l/jdWAK1Ok73BubvB2wpqIhrPtByJ2/80fNxCqxK1lWI0U+mMKH4S
tVoph4lo5I5PJkOIQLycLJx9T2gxughxtkQhBXlL/+2L0aT+yMOurMJBAoGBANtp
l6xFY3KypZ2N9yUCYjcdT9//daklMEfWU3FbrGZ16HSz5pAkPc80/XMklG1XlY2m
t5SWP93Fyn8y1zLec8EM6DPLkVMn38LwUJQt/ne7nFF6GLOvVPsQVRKSU9RzP+EJ
Hn7ForqoHWF5PfjbXufDur6moZt2HT0SpZ0R+tPJAoGAEL/9aLHF60UfS+eL7xvc
+jDqf9SB2xJzsjYnyjnCLYXNtCKBOwaM+WF2lnxdDPMOYCbRZt4sghgE8Q8SOPKN
GCe3KlF1XxDn9mYcaOeLihKjMdU8ibuzNMAmHnLPLnVRzC3sx4r0Sxz79LedpqIc
Ox3K47HnMNpDqY9wdBlcFsECgYA0u6kXX0nqfCMvvboDbBI82s+ir1wQ/f4fldRS
L009BuOKgN5OEFfGoB61+Lmvmdg4xjPjA0VwQKRNc+OitzIs2LRKFofj63Zs/KLx
Kii5kB6eunCLZv1Opfs8TmzVZ6mXpUBuCYP1xofhMGmDkP27SCBux8+ZdIbMcdnZ
6UNWeQKBgQDAYC0SA4XLSCkfw2vgqPAzCsVZnTwsG1fX8EP4lMKXuD3gO//2N1zI
BMysZdhPsYIqXE9eVF3qjv2IhZLSyQcRUPeK34GPYBtt9iFzCvAOqcdV9hvGDGFj
zRs7wPa/18Cg+cACXs2gkhnFnG+0PRTH1ouIKpWOuoi31viqOsWRUg==
-----END RSA PRIVATE KEY-----`

	testPkiSingleDomainCertificateNoChain string = `-----BEGIN CERTIFICATE-----
MIIEfTCCAmWgAwIBAgIUSu7YhhfPnRfyr30JBVOPg5A1A9QwDQYJKoZIhvcNAQEL
BQAwODE2MDQGA1UEAxMtRGF5dG9uYSBUZXN0aW5nIEludGVybWVkaWF0ZSBBdXRo
b3JpdHkgVGllciAyMB4XDTE5MDcyOTE2MzEyM1oXDTE5MDgzMDE2MzE1M1owGjEY
MBYGA1UEAxMPd3d3LmV4YW1wbGUuY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8A
MIIBCgKCAQEAuaOUdJHtzATZ3ao4+o2rSWQlu9kOwMs1gRjpTTXc454LISveeQTW
/qkdFVu0VoX4+04y7FBN/giAIk3T5zN1QlxVnM7K78w/bZSZzdrOKoJEGpIhV0kw
iZtv+Nekzyw5hJzZqtqNPJARISrWxTf7O7cjiPbNyY5dquUToY2aSDJBzhqzNRsx
M6Syl8wIcM8TBm/Dsq+lJYfGdVevZ4j6UXkATd2wOCnswbzTR3S0VUxdCDnE6+c4
yUt28Qu3SvaFT9OGVXegw5n8G6Dgs/PHyqNQJziBU1uXCFWcUtqcBo9X39BV4qBv
ZKXs6b3m4WvG1+Rqadqu+W+dhsjVAfVySwIDAQABo4GcMIGZMA4GA1UdDwEB/wQE
AwIDqDAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwDAYDVR0TAQH/BAIw
ADAdBgNVHQ4EFgQUH8VlKKDUDD3F+tzudOgmQ05JR6swHwYDVR0jBBgwFoAUvUxx
TvztZbcDfJj7UL5HgfCnAsgwGgYDVR0RBBMwEYIPd3d3LmV4YW1wbGUuY29tMA0G
CSqGSIb3DQEBCwUAA4ICAQBpfHUaVuA+GqLC49DZbpOkzcgsNTpFLqjc/ztQje9o
XBj+M1PlBjbC0DsUGiJ+MLdS4JTsmeWvNd0lBy+X+P+YfjmZ5UcHY1b5vRpW8SGA
NULkaM7jXBQkjsZ8kIj4k0RWW5UZ/h7n/sqAnrXzKc+ajjG/dZsxJgv3th6xCx46
x70M+iTq3Em8e8s0aZKqCTpfBWtDvweKFX19+fTdVnNXCSChprCc2pPqkFYbs2m+
2sSfU5OtmP4ExfliqGnpKuQI7hhLFxPIArp+c2M8ZR7k9TuGdS1ZSrGZKqnsVTRc
x2bEsPxefkJELE02vKMDwg0pAC8WeAmOpcR2Yt7zUW73XoK2xWUwgoLfeAf/tdwh
uYp2oEpKepHL6kOpezK7aE1aTIpNKGbP3H7x8UmKD6H3cxn5D/yjHrLOGesBoRJp
87GJCOE613HRKNZlQat4DA28mGjRnFeZ69IiG1MVLoBnHWKU7l71NFiTIxLpLh/G
WZUeab1gSrcSZqUlynY96ugSLKXKfGq4y+S4A70+Aaol58JQFtF1UZL30cAgT+XT
yUdWOd4FDwcGg2TQgCtJQryaD8yyTX9pCWHIdt2Pxl6OT1vUAgD1KafjUHVYB9+m
5+wGdPlC6WrJN5++642buI0rjPE8H8acLhtB73tLVhLCJMNOB2MFX0WwxAE6g+vw
EQ==
-----END CERTIFICATE-----`

	testPkiMultipleDomainCertificateNoChain string = `-----BEGIN CERTIFICATE-----
MIIEnjCCAoagAwIBAgIUKhBDXRw8eWzrc4SRGkYCIGPJXgEwDQYJKoZIhvcNAQEL
BQAwODE2MDQGA1UEAxMtRGF5dG9uYSBUZXN0aW5nIEludGVybWVkaWF0ZSBBdXRo
b3JpdHkgVGllciAyMB4XDTE5MDcyOTE2MzUwNFoXDTE5MDgzMDE2MzUzNFowGjEY
MBYGA1UEAxMPd3d3LmV4YW1wbGUuY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8A
MIIBCgKCAQEA1Okp878HvyhUOHlhLeVm7k4GTW8UR4+pjjGnoIx7jndk+TeoMjm9
Fnz8oppb7NIYgpgMn6cQtq3fhWejVFVtMBYKXoNJvMZj5HVEqMi//OFzKtpUeK90
VDwYsASmqmN3EXh7VmpseE6pm9//blf/PJG5nFsSyFbOEavo3Jj/ZZrlCmIdNNaK
tn4YTYh1VvE9niB4hS6NEirPuCpTEjsqg/pCfHXIOrsa8+eyEj/hLLtCzGJG7IFP
iT8p5rlxqr5Kh5IrFfqn4gkgorAP/X8qCIRqfW4nFe8oAdcuZhjsvc4r0qwKOGYM
ObENonp8a4WvrIBRJEHwSCE37/8VjjoYCQIDAQABo4G9MIG6MA4GA1UdDwEB/wQE
AwIDqDAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwDAYDVR0TAQH/BAIw
ADAdBgNVHQ4EFgQUn9NbiWCcfDx2Mjh86WKGUelLCB0wHwYDVR0jBBgwFoAUvUxx
TvztZbcDfJj7UL5HgfCnAsgwOwYDVR0RBDQwMoIPd3d3LmV4YW1wbGUuY29tgg0q
LmV4YW1wbGUuY29tghB3d3cyLmV4YW1wbGUuY29tMA0GCSqGSIb3DQEBCwUAA4IC
AQBft7JaZS4k2bg6zw8ETwe+JMhc+kCAoWz1GUPgdHm7QQ/k0yYNYzseMDI1w4OB
FADnS7mGl7NO2dvxsOsYUFWr1e6S4jBljvy33ZlwuQj6gUa6DUu+NZdCyqAQGftt
G9klfzErsWyjU8yNorsM1v5Hm8O2ZC59wzgdXe9n51w0z9t07ryqK4SygDkyMpP8
uMMXouPyPXUPhT7IjEjAqDnC1qxgzXFgV6oUNkCRpfL6UG5tTZZ3cPNG2fHvWmH9
6DFXhRyuSiYtEdFhJXK9CU8a9gPGczegXdCiW83zwlAvfajxSsuYmc/eX4TzHjuf
SVUfQOyz/SCrSSOL2SMzXRkOO/HDA9iZq1WcLVIOWqLNYZ1UmSwgnpGQtGjCopm3
zIPe5hyJ0mpx2TywEjxoo/l2M9UMlSP+bByIuTyNyZkq8l0ytePfTgqsaGxqsdNg
wWf9GYB9+g2SDTaOillrlwGboF7O1JN0SYs/JsO23NQvwcMuoq7f66v7K4oEOfwl
V0anwoBUlp4KMY4AOoH9O4JR6pCiW//MHwzoXH82AzrjQ+y0LR7HqGgDuWy3RG2R
pTZVf9eSTEVsGmA7fV8Fb2EtHac/IOI9uvndrGnjaX/o4dnkUzR/kEcnFhppsrzd
ZOo310BBZY2/VRre6DI8kcOxjV9ipafxb9nsBmmrYkRbqQ==
-----END CERTIFICATE-----`

	testPkiSingleDomainCertificateWithChain string = `-----BEGIN CERTIFICATE-----
MIIEfTCCAmWgAwIBAgIUSu7YhhfPnRfyr30JBVOPg5A1A9QwDQYJKoZIhvcNAQEL
BQAwODE2MDQGA1UEAxMtRGF5dG9uYSBUZXN0aW5nIEludGVybWVkaWF0ZSBBdXRo
b3JpdHkgVGllciAyMB4XDTE5MDcyOTE2MzEyM1oXDTE5MDgzMDE2MzE1M1owGjEY
MBYGA1UEAxMPd3d3LmV4YW1wbGUuY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8A
MIIBCgKCAQEAuaOUdJHtzATZ3ao4+o2rSWQlu9kOwMs1gRjpTTXc454LISveeQTW
/qkdFVu0VoX4+04y7FBN/giAIk3T5zN1QlxVnM7K78w/bZSZzdrOKoJEGpIhV0kw
iZtv+Nekzyw5hJzZqtqNPJARISrWxTf7O7cjiPbNyY5dquUToY2aSDJBzhqzNRsx
M6Syl8wIcM8TBm/Dsq+lJYfGdVevZ4j6UXkATd2wOCnswbzTR3S0VUxdCDnE6+c4
yUt28Qu3SvaFT9OGVXegw5n8G6Dgs/PHyqNQJziBU1uXCFWcUtqcBo9X39BV4qBv
ZKXs6b3m4WvG1+Rqadqu+W+dhsjVAfVySwIDAQABo4GcMIGZMA4GA1UdDwEB/wQE
AwIDqDAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwDAYDVR0TAQH/BAIw
ADAdBgNVHQ4EFgQUH8VlKKDUDD3F+tzudOgmQ05JR6swHwYDVR0jBBgwFoAUvUxx
TvztZbcDfJj7UL5HgfCnAsgwGgYDVR0RBBMwEYIPd3d3LmV4YW1wbGUuY29tMA0G
CSqGSIb3DQEBCwUAA4ICAQBpfHUaVuA+GqLC49DZbpOkzcgsNTpFLqjc/ztQje9o
XBj+M1PlBjbC0DsUGiJ+MLdS4JTsmeWvNd0lBy+X+P+YfjmZ5UcHY1b5vRpW8SGA
NULkaM7jXBQkjsZ8kIj4k0RWW5UZ/h7n/sqAnrXzKc+ajjG/dZsxJgv3th6xCx46
x70M+iTq3Em8e8s0aZKqCTpfBWtDvweKFX19+fTdVnNXCSChprCc2pPqkFYbs2m+
2sSfU5OtmP4ExfliqGnpKuQI7hhLFxPIArp+c2M8ZR7k9TuGdS1ZSrGZKqnsVTRc
x2bEsPxefkJELE02vKMDwg0pAC8WeAmOpcR2Yt7zUW73XoK2xWUwgoLfeAf/tdwh
uYp2oEpKepHL6kOpezK7aE1aTIpNKGbP3H7x8UmKD6H3cxn5D/yjHrLOGesBoRJp
87GJCOE613HRKNZlQat4DA28mGjRnFeZ69IiG1MVLoBnHWKU7l71NFiTIxLpLh/G
WZUeab1gSrcSZqUlynY96ugSLKXKfGq4y+S4A70+Aaol58JQFtF1UZL30cAgT+XT
yUdWOd4FDwcGg2TQgCtJQryaD8yyTX9pCWHIdt2Pxl6OT1vUAgD1KafjUHVYB9+m
5+wGdPlC6WrJN5++642buI0rjPE8H8acLhtB73tLVhLCJMNOB2MFX0WwxAE6g+vw
EQ==
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIFZDCCA0ygAwIBAgIUPHF5fjq5+L66Bp/rCVR0+f6sl0wwDQYJKoZIhvcNAQEL
BQAwODE2MDQGA1UEAxMtRGF5dG9uYSBUZXN0aW5nIEludGVybWVkaWF0ZSBBdXRo
b3JpdHkgVGllciAxMB4XDTE5MDcyOTE2MzA0MFoXDTI5MDcyMzE2MzExMFowODE2
MDQGA1UEAxMtRGF5dG9uYSBUZXN0aW5nIEludGVybWVkaWF0ZSBBdXRob3JpdHkg
VGllciAyMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAxHkjFBw1utW9
9xouOR3T0zAg3aLVjzoDcd/L1UlQ6VFHgFK1nDhCuUB4sl4XuGTo2Ja8nYL048pN
2wNZ4+N61MOYj9B+dD5Zea8DOeObKUNS55Dor6ztgyItnKsspxdYwyYVqr02XOTR
PUqMuMy3PkVth9RFGEZZC8fMAGgPSVmQND8Kz7Zse+9emOze7vl1sEdVbgJQ8WvU
JDpdkzmAYqqw4qhibfvtPrMwk6v8N7m5JanBPnxl5vZEReIlHQkcNIqyHBNZeu3m
FBcp3BF9yxFJFUayGcTIpCWvl2DJZaAcNJHtijyv+ubyZBhEWpgHavtdFv1Rjs/e
d4VNYmxywxTdkEAWsHK2j0l1labSbt2oUhBFk1Z+wqFzsD70J7Dw1LppfOBjcieM
s2Dx21yAsab0oJW81cNeye3bDRmwc9vh0++zG76H4IJqE8QYS0CVcDMQKZMMulkJ
FkCjHaQwbwoisUj5p1KdrZfXBES6Q4vglZO1MsYtn0mqD+cndY52FO6fk7h52ntX
p3tY5LovTJx3I2Apbj+c1eWm+fZfPSmR2u2Xkfe1SEURtoavPUJprPzIxH8qLWaM
TvzWQAVE0c3AhWKfCfWRIduve3sakw6kOTf4jmTLa+M9QOOEOifZuHOHH/jgI5He
Hc4iasqstDPiRympeoTBpGwTQtSxxPECAwEAAaNmMGQwDgYDVR0PAQH/BAQDAgEG
MBIGA1UdEwEB/wQIMAYBAf8CAQAwHQYDVR0OBBYEFL1McU787WW3A3yY+1C+R4Hw
pwLIMB8GA1UdIwQYMBaAFBjGDCozLsEbZ/2IDQhYla3+E3JoMA0GCSqGSIb3DQEB
CwUAA4ICAQCdCvSEwNDUI2GnW5FPxQyvgIF6reW8Y3pWsH1nCKUAA6m7ZR/H+O5Z
S6Fsv9BPaKR5Zvy6K8DQKJOrDw+lKywraFfg8eVJ8ig/ktpRwD1JM82vbK6G75+7
tTCtsyu6asyWaQbVEvx/hYw89UQbkY76zi25E7P01srzGJUZ1X656MCzDzpb027s
PZpj3cro6qzi2pxvdC7xEpZf8x1r4RDqjk/Jf8Q5BY2nEZSlBsOB49FnoxoCQC3W
ReNcWxMZOCiXF1ZxhXgTAUnF6KckkWeSy6/t9e1CEJUHucOvUCfptgtzTy6nYT3b
Q/+BmtVtQP0WZnT8j1RtCrSRe0sDijdM19iO/XsUDWHCIALFqMyIM3dQLg2khHoi
ve1ACUWbXqdiob38nAtCKkMWvGxKKwOkgzYf7DodOGsQWg+SXB12tuvoyyhz3rtU
SE0xn+eNxqiX/J80pXytC3IxcooaOMwX60ZwpYPa/DlZcKwgrxvKXvvVTf9pAseh
ez0wM89j7SS1usdpb+5XnArL5NFm8DuGNcmP8WBt9tcsN8wmqMNJDibNY7rINRR8
v9yxTMoOsnYKv7Nj6uxjbbgwC7EKGwAetB1nZMX0Q0wBfE898PlJ4EYY8BjS0KSy
bBaUAy2osOAQdUa6F73/sG3eZQnejtUNo+luq+p6RI4wOkpJXXuaPg==
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIFVTCCAz2gAwIBAgIUGbCWtfBfyDS+RYLu7zmPXBn4QIIwDQYJKoZIhvcNAQEL
BQAwKTEnMCUGA1UEAxMeRGF5dG9uYSBUZXN0aW5nIFJvb3QgQXV0aG9yaXR5MB4X
DTE5MDcyOTE2MzAzMVoXDTI5MDcyNDE2MzEwMVowODE2MDQGA1UEAxMtRGF5dG9u
YSBUZXN0aW5nIEludGVybWVkaWF0ZSBBdXRob3JpdHkgVGllciAxMIICIjANBgkq
hkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAr3yYPikSzxUx80Aj7tQl99/aISCpRLPu
2Jt1wGy7YuDSgBQzUIE/UU54qlvgFzQWJkixm7+Nf70EscB/jmgZdhJiR6IwCG/2
j/JH3mFCcyJiGB/iR7YTNUffi0s8DrnDtMwR1+olZeUGWgrzN593TK1qWtZqo4lw
19syPzES+1KvmfH4cuQJU6JbWd2PI9gfP6jQP4+sj3D1tQnKzVum038O0rEO5YgS
wy61hlvU9xIh0Hd8kZZSTr8bi4YIwOg0vb1XeXMNw/jZN+qkxR/18W4rncETc4om
PpAqzbEEHqii984OIaSesp7C8EERSRIbSc7AbReaVD4GtWElBODQ5qUPWm8ujBD/
P9390e6EPTPWAmAKZoxQBeTaMmctaVu+pjq5wje9yT59I/0NXlPvs6eLeWomxA3t
UnrDEbV5PYiSs297b+4BMpGC1GW1HELAhnHnuEjvAwBPJipKEGB5PiVAFZd8kesf
1ylPRu8bGsdfPca0a4Zljvhq2/CAG1sHLC6DKIoXz2+z2VVPZwpKb9RpzNvEpf6J
5ACzpUE1u330hnMJyWkg3aIO2zFTmpGGXUeKVM3ZUrqbJDRunKzt2erBbhJt5gwI
zqcMXW3xY+a0vaYTLi7/uP3WbfVH7oDQWr0XWhiD8QZMaX3bKgfz0BADVJJ5H7ty
0bulASy55KECAwEAAaNmMGQwDgYDVR0PAQH/BAQDAgEGMBIGA1UdEwEB/wQIMAYB
Af8CAQEwHQYDVR0OBBYEFBjGDCozLsEbZ/2IDQhYla3+E3JoMB8GA1UdIwQYMBaA
FAg0PfrOYyUDFQQnRK24dlLxB7KgMA0GCSqGSIb3DQEBCwUAA4ICAQBahA59ak6W
29VwuzF3UcwDjVDLD9TJ2yCz0tBiKGgs76OCfJPMnIkc4eTG/n0B4QnCTyZKSPsF
GiLxPvdU4ocK2ZrGv6yAJNG4oNSqF7rq50zbfbiDTFoXZRsgksmnsQiI1WhRnb5s
2O+dznVZZcu7f+DNfRghqyepMwMTheDWmnLK2tVH5WWZK4TxJMLkK51c9ho/UOuy
mTYmN7P4TSJ7QF5qail9EMabI6Kysc2huJaiNsR6l3+FCqz3zPtq9Kd0Nkw+0fhf
BuM1QjEnmB5OX0QuT76V+qLJlt7aUcLmuHGuIgVuplF7nKdKLTAeCzxdScz4bDZ1
Ff+5tVlLuoCUgJqERuN9HREyA1+uWkPDTm5Wl8xHzj6GzN5/9v/P0M5ePXrUNGYx
HAwmsBeZDrAhD6Zq0YzHiHKkKif4HsT6jzPRLsdpJ2z7dQFl0LaH5rDfycGOTS89
b8CMPZiz8+HEhgAEylKQRwCQqAXjDWGLYzDtq7xs7csvvuuLQdgY29GxWQNknrwz
JLoW4dgBFNyj7Qcs4k9aW598b9TC08KKcMbEXhzfB0NDHWzq7172w00ulRy5sNMH
EzcMkMpzDyMJxDDkdnix3thN0N+p5K2tG7nG3mtRDbn6RAlTJMMGihaVv2Mc1SGu
tl5GoCqKBvvyj6u59NgoDTMlAYJ8DKlNNw==
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIFRjCCAy6gAwIBAgIUBToj8szGWnPPsjUz8XeOcAj59/QwDQYJKoZIhvcNAQEL
BQAwKTEnMCUGA1UEAxMeRGF5dG9uYSBUZXN0aW5nIFJvb3QgQXV0aG9yaXR5MB4X
DTE5MDcyOTE2MzAyOFoXDTI5MDcyNTE2MzA1NVowKTEnMCUGA1UEAxMeRGF5dG9u
YSBUZXN0aW5nIFJvb3QgQXV0aG9yaXR5MIICIjANBgkqhkiG9w0BAQEFAAOCAg8A
MIICCgKCAgEAt9wd9d1LQHDgneoMSMqU8sN/t+AeC4vDIcvA1DVr8gIwF745qp7H
4W0bu1nzB4sPMxIumwzuw9m+mxXo4zcbMmYUyowcx2nhH3MNaF6hX74eMeMaPAVr
4lMsMK3swvjvFywwCFtSgvsWbulDgAJlCf3PKKXtbqGPcn7pP4cPIifHN9drPoR5
O2wfy0JuE6mg3iYsy0Bl9mQixnsQZO+WWPbW853iTctCIaPq9VE6H0T9VqTujIw8
ldOwrwkUDOSh3IEfNBRLRoanpSvg4ZktdF6JKNqqtBHE6pOpGX2LuR2pV+S7ylim
4pJaCtKj35jhMLpWxXARx+5ejLeAHv0Ye4SJhUInaaWaDiDyR+eShKpKkhjKaME7
0DKyzdyZAQDF5hRaYCHHBodZrkyZlGOx6cE8fH0icRqJ9uzRwTk7keJ6HACQcYDN
d4zfhoUmPxkxPQaMf6pTJk4ABtFPw9aktFcJ4w+jWLD/eZZKkwNhjy3NOUXVV0aj
gFBPcQ8F9rf0pPfNR8NMpuw0Y7BkJovv98mgTFTFUqYaR0BsVuEVBFV796s663nK
jq0XO3nk6YLdOG/dFJBtsxFkdr0PpRR7bQXs7FNMkAgqGytDVttbZGqE9Pme7+B6
XyiPVQNkb6fZIxQxoaxzhMoOYCYJXqDVHs5VKKraLFlhmA6C5IrJOfcCAwEAAaNm
MGQwDgYDVR0PAQH/BAQDAgEGMBIGA1UdEwEB/wQIMAYBAf8CAQIwHQYDVR0OBBYE
FAg0PfrOYyUDFQQnRK24dlLxB7KgMB8GA1UdIwQYMBaAFAg0PfrOYyUDFQQnRK24
dlLxB7KgMA0GCSqGSIb3DQEBCwUAA4ICAQBsAOhZk/J/ClOjp1Ktk8SPEOx3mttF
hV3KTA7Lpw9FZcOfUwUTbwe3P1mnyHI1oNfxw1TqYETlYOsC3PKBEiCoL25JM8Fk
yuZeqgBGCyqx9HOQNsLc2QC0CsnSytMGCToLLXlYW6bSIoGx5ZXty+Sa6nBWX98q
OJwL0kLO8BUoZ9n/+URYQ9tJpNj7ik64v5FltUq9qsq2Ki0toINWkKUbIxJ59rwf
VDFnJ5KASf4HkVKL7XfVfCD+aqbrj+IdzL+zGhg5t6oWB7Q973+F2zMmcWE4z+84
VBsyl/DW4Zx73xk7c2avKp1JVqH8aVRNQKWqXk1WW44fAAFt5lglgRZYFRdfKXqc
kcSrZvxjzUDyp+d9ihj/RYubwYBUVy7BAbjzyzjJ7mmPuOQkeeTZIEay0ZJs8kty
qLvEX2qMjbVivp14ezKw3GYLbNw5s9evmxFRMJQa5QTZUKR0W8HDJllcVcLG9IWQ
8wUyu2evId06Pg+cikIrE2PJ0WwadK+kLo22u2RgmuwIfOZrZQaZaXMaQc+P5wot
HzlQCIvAhvAwj+T3s6O4OrYhq39tKGCe/X9CJ+j+qYUJJ5l8VrWeHNEi2Kjjmmos
jj/Eyj+Ofe1YGOTUUVsZ5cs2Y1rs9ep3rhqNN4zI8jNax+RTjJtLNI3leTi5gV71
evoHW7vpj9w4LQ==
-----END CERTIFICATE-----`

	testPkiMultipleDomainCertificateWithChain string = `-----BEGIN CERTIFICATE-----
MIIEnjCCAoagAwIBAgIUKhBDXRw8eWzrc4SRGkYCIGPJXgEwDQYJKoZIhvcNAQEL
BQAwODE2MDQGA1UEAxMtRGF5dG9uYSBUZXN0aW5nIEludGVybWVkaWF0ZSBBdXRo
b3JpdHkgVGllciAyMB4XDTE5MDcyOTE2MzUwNFoXDTE5MDgzMDE2MzUzNFowGjEY
MBYGA1UEAxMPd3d3LmV4YW1wbGUuY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8A
MIIBCgKCAQEA1Okp878HvyhUOHlhLeVm7k4GTW8UR4+pjjGnoIx7jndk+TeoMjm9
Fnz8oppb7NIYgpgMn6cQtq3fhWejVFVtMBYKXoNJvMZj5HVEqMi//OFzKtpUeK90
VDwYsASmqmN3EXh7VmpseE6pm9//blf/PJG5nFsSyFbOEavo3Jj/ZZrlCmIdNNaK
tn4YTYh1VvE9niB4hS6NEirPuCpTEjsqg/pCfHXIOrsa8+eyEj/hLLtCzGJG7IFP
iT8p5rlxqr5Kh5IrFfqn4gkgorAP/X8qCIRqfW4nFe8oAdcuZhjsvc4r0qwKOGYM
ObENonp8a4WvrIBRJEHwSCE37/8VjjoYCQIDAQABo4G9MIG6MA4GA1UdDwEB/wQE
AwIDqDAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwDAYDVR0TAQH/BAIw
ADAdBgNVHQ4EFgQUn9NbiWCcfDx2Mjh86WKGUelLCB0wHwYDVR0jBBgwFoAUvUxx
TvztZbcDfJj7UL5HgfCnAsgwOwYDVR0RBDQwMoIPd3d3LmV4YW1wbGUuY29tgg0q
LmV4YW1wbGUuY29tghB3d3cyLmV4YW1wbGUuY29tMA0GCSqGSIb3DQEBCwUAA4IC
AQBft7JaZS4k2bg6zw8ETwe+JMhc+kCAoWz1GUPgdHm7QQ/k0yYNYzseMDI1w4OB
FADnS7mGl7NO2dvxsOsYUFWr1e6S4jBljvy33ZlwuQj6gUa6DUu+NZdCyqAQGftt
G9klfzErsWyjU8yNorsM1v5Hm8O2ZC59wzgdXe9n51w0z9t07ryqK4SygDkyMpP8
uMMXouPyPXUPhT7IjEjAqDnC1qxgzXFgV6oUNkCRpfL6UG5tTZZ3cPNG2fHvWmH9
6DFXhRyuSiYtEdFhJXK9CU8a9gPGczegXdCiW83zwlAvfajxSsuYmc/eX4TzHjuf
SVUfQOyz/SCrSSOL2SMzXRkOO/HDA9iZq1WcLVIOWqLNYZ1UmSwgnpGQtGjCopm3
zIPe5hyJ0mpx2TywEjxoo/l2M9UMlSP+bByIuTyNyZkq8l0ytePfTgqsaGxqsdNg
wWf9GYB9+g2SDTaOillrlwGboF7O1JN0SYs/JsO23NQvwcMuoq7f66v7K4oEOfwl
V0anwoBUlp4KMY4AOoH9O4JR6pCiW//MHwzoXH82AzrjQ+y0LR7HqGgDuWy3RG2R
pTZVf9eSTEVsGmA7fV8Fb2EtHac/IOI9uvndrGnjaX/o4dnkUzR/kEcnFhppsrzd
ZOo310BBZY2/VRre6DI8kcOxjV9ipafxb9nsBmmrYkRbqQ==
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIFZDCCA0ygAwIBAgIUPHF5fjq5+L66Bp/rCVR0+f6sl0wwDQYJKoZIhvcNAQEL
BQAwODE2MDQGA1UEAxMtRGF5dG9uYSBUZXN0aW5nIEludGVybWVkaWF0ZSBBdXRo
b3JpdHkgVGllciAxMB4XDTE5MDcyOTE2MzA0MFoXDTI5MDcyMzE2MzExMFowODE2
MDQGA1UEAxMtRGF5dG9uYSBUZXN0aW5nIEludGVybWVkaWF0ZSBBdXRob3JpdHkg
VGllciAyMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAxHkjFBw1utW9
9xouOR3T0zAg3aLVjzoDcd/L1UlQ6VFHgFK1nDhCuUB4sl4XuGTo2Ja8nYL048pN
2wNZ4+N61MOYj9B+dD5Zea8DOeObKUNS55Dor6ztgyItnKsspxdYwyYVqr02XOTR
PUqMuMy3PkVth9RFGEZZC8fMAGgPSVmQND8Kz7Zse+9emOze7vl1sEdVbgJQ8WvU
JDpdkzmAYqqw4qhibfvtPrMwk6v8N7m5JanBPnxl5vZEReIlHQkcNIqyHBNZeu3m
FBcp3BF9yxFJFUayGcTIpCWvl2DJZaAcNJHtijyv+ubyZBhEWpgHavtdFv1Rjs/e
d4VNYmxywxTdkEAWsHK2j0l1labSbt2oUhBFk1Z+wqFzsD70J7Dw1LppfOBjcieM
s2Dx21yAsab0oJW81cNeye3bDRmwc9vh0++zG76H4IJqE8QYS0CVcDMQKZMMulkJ
FkCjHaQwbwoisUj5p1KdrZfXBES6Q4vglZO1MsYtn0mqD+cndY52FO6fk7h52ntX
p3tY5LovTJx3I2Apbj+c1eWm+fZfPSmR2u2Xkfe1SEURtoavPUJprPzIxH8qLWaM
TvzWQAVE0c3AhWKfCfWRIduve3sakw6kOTf4jmTLa+M9QOOEOifZuHOHH/jgI5He
Hc4iasqstDPiRympeoTBpGwTQtSxxPECAwEAAaNmMGQwDgYDVR0PAQH/BAQDAgEG
MBIGA1UdEwEB/wQIMAYBAf8CAQAwHQYDVR0OBBYEFL1McU787WW3A3yY+1C+R4Hw
pwLIMB8GA1UdIwQYMBaAFBjGDCozLsEbZ/2IDQhYla3+E3JoMA0GCSqGSIb3DQEB
CwUAA4ICAQCdCvSEwNDUI2GnW5FPxQyvgIF6reW8Y3pWsH1nCKUAA6m7ZR/H+O5Z
S6Fsv9BPaKR5Zvy6K8DQKJOrDw+lKywraFfg8eVJ8ig/ktpRwD1JM82vbK6G75+7
tTCtsyu6asyWaQbVEvx/hYw89UQbkY76zi25E7P01srzGJUZ1X656MCzDzpb027s
PZpj3cro6qzi2pxvdC7xEpZf8x1r4RDqjk/Jf8Q5BY2nEZSlBsOB49FnoxoCQC3W
ReNcWxMZOCiXF1ZxhXgTAUnF6KckkWeSy6/t9e1CEJUHucOvUCfptgtzTy6nYT3b
Q/+BmtVtQP0WZnT8j1RtCrSRe0sDijdM19iO/XsUDWHCIALFqMyIM3dQLg2khHoi
ve1ACUWbXqdiob38nAtCKkMWvGxKKwOkgzYf7DodOGsQWg+SXB12tuvoyyhz3rtU
SE0xn+eNxqiX/J80pXytC3IxcooaOMwX60ZwpYPa/DlZcKwgrxvKXvvVTf9pAseh
ez0wM89j7SS1usdpb+5XnArL5NFm8DuGNcmP8WBt9tcsN8wmqMNJDibNY7rINRR8
v9yxTMoOsnYKv7Nj6uxjbbgwC7EKGwAetB1nZMX0Q0wBfE898PlJ4EYY8BjS0KSy
bBaUAy2osOAQdUa6F73/sG3eZQnejtUNo+luq+p6RI4wOkpJXXuaPg==
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIFVTCCAz2gAwIBAgIUGbCWtfBfyDS+RYLu7zmPXBn4QIIwDQYJKoZIhvcNAQEL
BQAwKTEnMCUGA1UEAxMeRGF5dG9uYSBUZXN0aW5nIFJvb3QgQXV0aG9yaXR5MB4X
DTE5MDcyOTE2MzAzMVoXDTI5MDcyNDE2MzEwMVowODE2MDQGA1UEAxMtRGF5dG9u
YSBUZXN0aW5nIEludGVybWVkaWF0ZSBBdXRob3JpdHkgVGllciAxMIICIjANBgkq
hkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAr3yYPikSzxUx80Aj7tQl99/aISCpRLPu
2Jt1wGy7YuDSgBQzUIE/UU54qlvgFzQWJkixm7+Nf70EscB/jmgZdhJiR6IwCG/2
j/JH3mFCcyJiGB/iR7YTNUffi0s8DrnDtMwR1+olZeUGWgrzN593TK1qWtZqo4lw
19syPzES+1KvmfH4cuQJU6JbWd2PI9gfP6jQP4+sj3D1tQnKzVum038O0rEO5YgS
wy61hlvU9xIh0Hd8kZZSTr8bi4YIwOg0vb1XeXMNw/jZN+qkxR/18W4rncETc4om
PpAqzbEEHqii984OIaSesp7C8EERSRIbSc7AbReaVD4GtWElBODQ5qUPWm8ujBD/
P9390e6EPTPWAmAKZoxQBeTaMmctaVu+pjq5wje9yT59I/0NXlPvs6eLeWomxA3t
UnrDEbV5PYiSs297b+4BMpGC1GW1HELAhnHnuEjvAwBPJipKEGB5PiVAFZd8kesf
1ylPRu8bGsdfPca0a4Zljvhq2/CAG1sHLC6DKIoXz2+z2VVPZwpKb9RpzNvEpf6J
5ACzpUE1u330hnMJyWkg3aIO2zFTmpGGXUeKVM3ZUrqbJDRunKzt2erBbhJt5gwI
zqcMXW3xY+a0vaYTLi7/uP3WbfVH7oDQWr0XWhiD8QZMaX3bKgfz0BADVJJ5H7ty
0bulASy55KECAwEAAaNmMGQwDgYDVR0PAQH/BAQDAgEGMBIGA1UdEwEB/wQIMAYB
Af8CAQEwHQYDVR0OBBYEFBjGDCozLsEbZ/2IDQhYla3+E3JoMB8GA1UdIwQYMBaA
FAg0PfrOYyUDFQQnRK24dlLxB7KgMA0GCSqGSIb3DQEBCwUAA4ICAQBahA59ak6W
29VwuzF3UcwDjVDLD9TJ2yCz0tBiKGgs76OCfJPMnIkc4eTG/n0B4QnCTyZKSPsF
GiLxPvdU4ocK2ZrGv6yAJNG4oNSqF7rq50zbfbiDTFoXZRsgksmnsQiI1WhRnb5s
2O+dznVZZcu7f+DNfRghqyepMwMTheDWmnLK2tVH5WWZK4TxJMLkK51c9ho/UOuy
mTYmN7P4TSJ7QF5qail9EMabI6Kysc2huJaiNsR6l3+FCqz3zPtq9Kd0Nkw+0fhf
BuM1QjEnmB5OX0QuT76V+qLJlt7aUcLmuHGuIgVuplF7nKdKLTAeCzxdScz4bDZ1
Ff+5tVlLuoCUgJqERuN9HREyA1+uWkPDTm5Wl8xHzj6GzN5/9v/P0M5ePXrUNGYx
HAwmsBeZDrAhD6Zq0YzHiHKkKif4HsT6jzPRLsdpJ2z7dQFl0LaH5rDfycGOTS89
b8CMPZiz8+HEhgAEylKQRwCQqAXjDWGLYzDtq7xs7csvvuuLQdgY29GxWQNknrwz
JLoW4dgBFNyj7Qcs4k9aW598b9TC08KKcMbEXhzfB0NDHWzq7172w00ulRy5sNMH
EzcMkMpzDyMJxDDkdnix3thN0N+p5K2tG7nG3mtRDbn6RAlTJMMGihaVv2Mc1SGu
tl5GoCqKBvvyj6u59NgoDTMlAYJ8DKlNNw==
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIFRjCCAy6gAwIBAgIUBToj8szGWnPPsjUz8XeOcAj59/QwDQYJKoZIhvcNAQEL
BQAwKTEnMCUGA1UEAxMeRGF5dG9uYSBUZXN0aW5nIFJvb3QgQXV0aG9yaXR5MB4X
DTE5MDcyOTE2MzAyOFoXDTI5MDcyNTE2MzA1NVowKTEnMCUGA1UEAxMeRGF5dG9u
YSBUZXN0aW5nIFJvb3QgQXV0aG9yaXR5MIICIjANBgkqhkiG9w0BAQEFAAOCAg8A
MIICCgKCAgEAt9wd9d1LQHDgneoMSMqU8sN/t+AeC4vDIcvA1DVr8gIwF745qp7H
4W0bu1nzB4sPMxIumwzuw9m+mxXo4zcbMmYUyowcx2nhH3MNaF6hX74eMeMaPAVr
4lMsMK3swvjvFywwCFtSgvsWbulDgAJlCf3PKKXtbqGPcn7pP4cPIifHN9drPoR5
O2wfy0JuE6mg3iYsy0Bl9mQixnsQZO+WWPbW853iTctCIaPq9VE6H0T9VqTujIw8
ldOwrwkUDOSh3IEfNBRLRoanpSvg4ZktdF6JKNqqtBHE6pOpGX2LuR2pV+S7ylim
4pJaCtKj35jhMLpWxXARx+5ejLeAHv0Ye4SJhUInaaWaDiDyR+eShKpKkhjKaME7
0DKyzdyZAQDF5hRaYCHHBodZrkyZlGOx6cE8fH0icRqJ9uzRwTk7keJ6HACQcYDN
d4zfhoUmPxkxPQaMf6pTJk4ABtFPw9aktFcJ4w+jWLD/eZZKkwNhjy3NOUXVV0aj
gFBPcQ8F9rf0pPfNR8NMpuw0Y7BkJovv98mgTFTFUqYaR0BsVuEVBFV796s663nK
jq0XO3nk6YLdOG/dFJBtsxFkdr0PpRR7bQXs7FNMkAgqGytDVttbZGqE9Pme7+B6
XyiPVQNkb6fZIxQxoaxzhMoOYCYJXqDVHs5VKKraLFlhmA6C5IrJOfcCAwEAAaNm
MGQwDgYDVR0PAQH/BAQDAgEGMBIGA1UdEwEB/wQIMAYBAf8CAQIwHQYDVR0OBBYE
FAg0PfrOYyUDFQQnRK24dlLxB7KgMB8GA1UdIwQYMBaAFAg0PfrOYyUDFQQnRK24
dlLxB7KgMA0GCSqGSIb3DQEBCwUAA4ICAQBsAOhZk/J/ClOjp1Ktk8SPEOx3mttF
hV3KTA7Lpw9FZcOfUwUTbwe3P1mnyHI1oNfxw1TqYETlYOsC3PKBEiCoL25JM8Fk
yuZeqgBGCyqx9HOQNsLc2QC0CsnSytMGCToLLXlYW6bSIoGx5ZXty+Sa6nBWX98q
OJwL0kLO8BUoZ9n/+URYQ9tJpNj7ik64v5FltUq9qsq2Ki0toINWkKUbIxJ59rwf
VDFnJ5KASf4HkVKL7XfVfCD+aqbrj+IdzL+zGhg5t6oWB7Q973+F2zMmcWE4z+84
VBsyl/DW4Zx73xk7c2avKp1JVqH8aVRNQKWqXk1WW44fAAFt5lglgRZYFRdfKXqc
kcSrZvxjzUDyp+d9ihj/RYubwYBUVy7BAbjzyzjJ7mmPuOQkeeTZIEay0ZJs8kty
qLvEX2qMjbVivp14ezKw3GYLbNw5s9evmxFRMJQa5QTZUKR0W8HDJllcVcLG9IWQ
8wUyu2evId06Pg+cikIrE2PJ0WwadK+kLo22u2RgmuwIfOZrZQaZaXMaQc+P5wot
HzlQCIvAhvAwj+T3s6O4OrYhq39tKGCe/X9CJ+j+qYUJJ5l8VrWeHNEi2Kjjmmos
jj/Eyj+Ofe1YGOTUUVsZ5cs2Y1rs9ep3rhqNN4zI8jNax+RTjJtLNI3leTi5gV71
evoHW7vpj9w4LQ==
-----END CERTIFICATE-----`

	testPkiIssueResponseSingleDomain string = `
{
  "request_id": "56006ae4-83ae-4937-8828-afd655b75bf9",
  "lease_id": "",
  "lease_duration": 0,
  "renewable": false,
  "data": {
    "ca_chain": [
      "-----BEGIN CERTIFICATE-----\nMIIFZDCCA0ygAwIBAgIUPHF5fjq5+L66Bp/rCVR0+f6sl0wwDQYJKoZIhvcNAQEL\nBQAwODE2MDQGA1UEAxMtRGF5dG9uYSBUZXN0aW5nIEludGVybWVkaWF0ZSBBdXRo\nb3JpdHkgVGllciAxMB4XDTE5MDcyOTE2MzA0MFoXDTI5MDcyMzE2MzExMFowODE2\nMDQGA1UEAxMtRGF5dG9uYSBUZXN0aW5nIEludGVybWVkaWF0ZSBBdXRob3JpdHkg\nVGllciAyMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAxHkjFBw1utW9\n9xouOR3T0zAg3aLVjzoDcd/L1UlQ6VFHgFK1nDhCuUB4sl4XuGTo2Ja8nYL048pN\n2wNZ4+N61MOYj9B+dD5Zea8DOeObKUNS55Dor6ztgyItnKsspxdYwyYVqr02XOTR\nPUqMuMy3PkVth9RFGEZZC8fMAGgPSVmQND8Kz7Zse+9emOze7vl1sEdVbgJQ8WvU\nJDpdkzmAYqqw4qhibfvtPrMwk6v8N7m5JanBPnxl5vZEReIlHQkcNIqyHBNZeu3m\nFBcp3BF9yxFJFUayGcTIpCWvl2DJZaAcNJHtijyv+ubyZBhEWpgHavtdFv1Rjs/e\nd4VNYmxywxTdkEAWsHK2j0l1labSbt2oUhBFk1Z+wqFzsD70J7Dw1LppfOBjcieM\ns2Dx21yAsab0oJW81cNeye3bDRmwc9vh0++zG76H4IJqE8QYS0CVcDMQKZMMulkJ\nFkCjHaQwbwoisUj5p1KdrZfXBES6Q4vglZO1MsYtn0mqD+cndY52FO6fk7h52ntX\np3tY5LovTJx3I2Apbj+c1eWm+fZfPSmR2u2Xkfe1SEURtoavPUJprPzIxH8qLWaM\nTvzWQAVE0c3AhWKfCfWRIduve3sakw6kOTf4jmTLa+M9QOOEOifZuHOHH/jgI5He\nHc4iasqstDPiRympeoTBpGwTQtSxxPECAwEAAaNmMGQwDgYDVR0PAQH/BAQDAgEG\nMBIGA1UdEwEB/wQIMAYBAf8CAQAwHQYDVR0OBBYEFL1McU787WW3A3yY+1C+R4Hw\npwLIMB8GA1UdIwQYMBaAFBjGDCozLsEbZ/2IDQhYla3+E3JoMA0GCSqGSIb3DQEB\nCwUAA4ICAQCdCvSEwNDUI2GnW5FPxQyvgIF6reW8Y3pWsH1nCKUAA6m7ZR/H+O5Z\nS6Fsv9BPaKR5Zvy6K8DQKJOrDw+lKywraFfg8eVJ8ig/ktpRwD1JM82vbK6G75+7\ntTCtsyu6asyWaQbVEvx/hYw89UQbkY76zi25E7P01srzGJUZ1X656MCzDzpb027s\nPZpj3cro6qzi2pxvdC7xEpZf8x1r4RDqjk/Jf8Q5BY2nEZSlBsOB49FnoxoCQC3W\nReNcWxMZOCiXF1ZxhXgTAUnF6KckkWeSy6/t9e1CEJUHucOvUCfptgtzTy6nYT3b\nQ/+BmtVtQP0WZnT8j1RtCrSRe0sDijdM19iO/XsUDWHCIALFqMyIM3dQLg2khHoi\nve1ACUWbXqdiob38nAtCKkMWvGxKKwOkgzYf7DodOGsQWg+SXB12tuvoyyhz3rtU\nSE0xn+eNxqiX/J80pXytC3IxcooaOMwX60ZwpYPa/DlZcKwgrxvKXvvVTf9pAseh\nez0wM89j7SS1usdpb+5XnArL5NFm8DuGNcmP8WBt9tcsN8wmqMNJDibNY7rINRR8\nv9yxTMoOsnYKv7Nj6uxjbbgwC7EKGwAetB1nZMX0Q0wBfE898PlJ4EYY8BjS0KSy\nbBaUAy2osOAQdUa6F73/sG3eZQnejtUNo+luq+p6RI4wOkpJXXuaPg==\n-----END CERTIFICATE-----",
      "-----BEGIN CERTIFICATE-----\nMIIFVTCCAz2gAwIBAgIUGbCWtfBfyDS+RYLu7zmPXBn4QIIwDQYJKoZIhvcNAQEL\nBQAwKTEnMCUGA1UEAxMeRGF5dG9uYSBUZXN0aW5nIFJvb3QgQXV0aG9yaXR5MB4X\nDTE5MDcyOTE2MzAzMVoXDTI5MDcyNDE2MzEwMVowODE2MDQGA1UEAxMtRGF5dG9u\nYSBUZXN0aW5nIEludGVybWVkaWF0ZSBBdXRob3JpdHkgVGllciAxMIICIjANBgkq\nhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAr3yYPikSzxUx80Aj7tQl99/aISCpRLPu\n2Jt1wGy7YuDSgBQzUIE/UU54qlvgFzQWJkixm7+Nf70EscB/jmgZdhJiR6IwCG/2\nj/JH3mFCcyJiGB/iR7YTNUffi0s8DrnDtMwR1+olZeUGWgrzN593TK1qWtZqo4lw\n19syPzES+1KvmfH4cuQJU6JbWd2PI9gfP6jQP4+sj3D1tQnKzVum038O0rEO5YgS\nwy61hlvU9xIh0Hd8kZZSTr8bi4YIwOg0vb1XeXMNw/jZN+qkxR/18W4rncETc4om\nPpAqzbEEHqii984OIaSesp7C8EERSRIbSc7AbReaVD4GtWElBODQ5qUPWm8ujBD/\nP9390e6EPTPWAmAKZoxQBeTaMmctaVu+pjq5wje9yT59I/0NXlPvs6eLeWomxA3t\nUnrDEbV5PYiSs297b+4BMpGC1GW1HELAhnHnuEjvAwBPJipKEGB5PiVAFZd8kesf\n1ylPRu8bGsdfPca0a4Zljvhq2/CAG1sHLC6DKIoXz2+z2VVPZwpKb9RpzNvEpf6J\n5ACzpUE1u330hnMJyWkg3aIO2zFTmpGGXUeKVM3ZUrqbJDRunKzt2erBbhJt5gwI\nzqcMXW3xY+a0vaYTLi7/uP3WbfVH7oDQWr0XWhiD8QZMaX3bKgfz0BADVJJ5H7ty\n0bulASy55KECAwEAAaNmMGQwDgYDVR0PAQH/BAQDAgEGMBIGA1UdEwEB/wQIMAYB\nAf8CAQEwHQYDVR0OBBYEFBjGDCozLsEbZ/2IDQhYla3+E3JoMB8GA1UdIwQYMBaA\nFAg0PfrOYyUDFQQnRK24dlLxB7KgMA0GCSqGSIb3DQEBCwUAA4ICAQBahA59ak6W\n29VwuzF3UcwDjVDLD9TJ2yCz0tBiKGgs76OCfJPMnIkc4eTG/n0B4QnCTyZKSPsF\nGiLxPvdU4ocK2ZrGv6yAJNG4oNSqF7rq50zbfbiDTFoXZRsgksmnsQiI1WhRnb5s\n2O+dznVZZcu7f+DNfRghqyepMwMTheDWmnLK2tVH5WWZK4TxJMLkK51c9ho/UOuy\nmTYmN7P4TSJ7QF5qail9EMabI6Kysc2huJaiNsR6l3+FCqz3zPtq9Kd0Nkw+0fhf\nBuM1QjEnmB5OX0QuT76V+qLJlt7aUcLmuHGuIgVuplF7nKdKLTAeCzxdScz4bDZ1\nFf+5tVlLuoCUgJqERuN9HREyA1+uWkPDTm5Wl8xHzj6GzN5/9v/P0M5ePXrUNGYx\nHAwmsBeZDrAhD6Zq0YzHiHKkKif4HsT6jzPRLsdpJ2z7dQFl0LaH5rDfycGOTS89\nb8CMPZiz8+HEhgAEylKQRwCQqAXjDWGLYzDtq7xs7csvvuuLQdgY29GxWQNknrwz\nJLoW4dgBFNyj7Qcs4k9aW598b9TC08KKcMbEXhzfB0NDHWzq7172w00ulRy5sNMH\nEzcMkMpzDyMJxDDkdnix3thN0N+p5K2tG7nG3mtRDbn6RAlTJMMGihaVv2Mc1SGu\ntl5GoCqKBvvyj6u59NgoDTMlAYJ8DKlNNw==\n-----END CERTIFICATE-----",
      "-----BEGIN CERTIFICATE-----\nMIIFRjCCAy6gAwIBAgIUBToj8szGWnPPsjUz8XeOcAj59/QwDQYJKoZIhvcNAQEL\nBQAwKTEnMCUGA1UEAxMeRGF5dG9uYSBUZXN0aW5nIFJvb3QgQXV0aG9yaXR5MB4X\nDTE5MDcyOTE2MzAyOFoXDTI5MDcyNTE2MzA1NVowKTEnMCUGA1UEAxMeRGF5dG9u\nYSBUZXN0aW5nIFJvb3QgQXV0aG9yaXR5MIICIjANBgkqhkiG9w0BAQEFAAOCAg8A\nMIICCgKCAgEAt9wd9d1LQHDgneoMSMqU8sN/t+AeC4vDIcvA1DVr8gIwF745qp7H\n4W0bu1nzB4sPMxIumwzuw9m+mxXo4zcbMmYUyowcx2nhH3MNaF6hX74eMeMaPAVr\n4lMsMK3swvjvFywwCFtSgvsWbulDgAJlCf3PKKXtbqGPcn7pP4cPIifHN9drPoR5\nO2wfy0JuE6mg3iYsy0Bl9mQixnsQZO+WWPbW853iTctCIaPq9VE6H0T9VqTujIw8\nldOwrwkUDOSh3IEfNBRLRoanpSvg4ZktdF6JKNqqtBHE6pOpGX2LuR2pV+S7ylim\n4pJaCtKj35jhMLpWxXARx+5ejLeAHv0Ye4SJhUInaaWaDiDyR+eShKpKkhjKaME7\n0DKyzdyZAQDF5hRaYCHHBodZrkyZlGOx6cE8fH0icRqJ9uzRwTk7keJ6HACQcYDN\nd4zfhoUmPxkxPQaMf6pTJk4ABtFPw9aktFcJ4w+jWLD/eZZKkwNhjy3NOUXVV0aj\ngFBPcQ8F9rf0pPfNR8NMpuw0Y7BkJovv98mgTFTFUqYaR0BsVuEVBFV796s663nK\njq0XO3nk6YLdOG/dFJBtsxFkdr0PpRR7bQXs7FNMkAgqGytDVttbZGqE9Pme7+B6\nXyiPVQNkb6fZIxQxoaxzhMoOYCYJXqDVHs5VKKraLFlhmA6C5IrJOfcCAwEAAaNm\nMGQwDgYDVR0PAQH/BAQDAgEGMBIGA1UdEwEB/wQIMAYBAf8CAQIwHQYDVR0OBBYE\nFAg0PfrOYyUDFQQnRK24dlLxB7KgMB8GA1UdIwQYMBaAFAg0PfrOYyUDFQQnRK24\ndlLxB7KgMA0GCSqGSIb3DQEBCwUAA4ICAQBsAOhZk/J/ClOjp1Ktk8SPEOx3mttF\nhV3KTA7Lpw9FZcOfUwUTbwe3P1mnyHI1oNfxw1TqYETlYOsC3PKBEiCoL25JM8Fk\nyuZeqgBGCyqx9HOQNsLc2QC0CsnSytMGCToLLXlYW6bSIoGx5ZXty+Sa6nBWX98q\nOJwL0kLO8BUoZ9n/+URYQ9tJpNj7ik64v5FltUq9qsq2Ki0toINWkKUbIxJ59rwf\nVDFnJ5KASf4HkVKL7XfVfCD+aqbrj+IdzL+zGhg5t6oWB7Q973+F2zMmcWE4z+84\nVBsyl/DW4Zx73xk7c2avKp1JVqH8aVRNQKWqXk1WW44fAAFt5lglgRZYFRdfKXqc\nkcSrZvxjzUDyp+d9ihj/RYubwYBUVy7BAbjzyzjJ7mmPuOQkeeTZIEay0ZJs8kty\nqLvEX2qMjbVivp14ezKw3GYLbNw5s9evmxFRMJQa5QTZUKR0W8HDJllcVcLG9IWQ\n8wUyu2evId06Pg+cikIrE2PJ0WwadK+kLo22u2RgmuwIfOZrZQaZaXMaQc+P5wot\nHzlQCIvAhvAwj+T3s6O4OrYhq39tKGCe/X9CJ+j+qYUJJ5l8VrWeHNEi2Kjjmmos\njj/Eyj+Ofe1YGOTUUVsZ5cs2Y1rs9ep3rhqNN4zI8jNax+RTjJtLNI3leTi5gV71\nevoHW7vpj9w4LQ==\n-----END CERTIFICATE-----"
    ],
    "certificate": "-----BEGIN CERTIFICATE-----\nMIIEfTCCAmWgAwIBAgIUSu7YhhfPnRfyr30JBVOPg5A1A9QwDQYJKoZIhvcNAQEL\nBQAwODE2MDQGA1UEAxMtRGF5dG9uYSBUZXN0aW5nIEludGVybWVkaWF0ZSBBdXRo\nb3JpdHkgVGllciAyMB4XDTE5MDcyOTE2MzEyM1oXDTE5MDgzMDE2MzE1M1owGjEY\nMBYGA1UEAxMPd3d3LmV4YW1wbGUuY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8A\nMIIBCgKCAQEAuaOUdJHtzATZ3ao4+o2rSWQlu9kOwMs1gRjpTTXc454LISveeQTW\n/qkdFVu0VoX4+04y7FBN/giAIk3T5zN1QlxVnM7K78w/bZSZzdrOKoJEGpIhV0kw\niZtv+Nekzyw5hJzZqtqNPJARISrWxTf7O7cjiPbNyY5dquUToY2aSDJBzhqzNRsx\nM6Syl8wIcM8TBm/Dsq+lJYfGdVevZ4j6UXkATd2wOCnswbzTR3S0VUxdCDnE6+c4\nyUt28Qu3SvaFT9OGVXegw5n8G6Dgs/PHyqNQJziBU1uXCFWcUtqcBo9X39BV4qBv\nZKXs6b3m4WvG1+Rqadqu+W+dhsjVAfVySwIDAQABo4GcMIGZMA4GA1UdDwEB/wQE\nAwIDqDAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwDAYDVR0TAQH/BAIw\nADAdBgNVHQ4EFgQUH8VlKKDUDD3F+tzudOgmQ05JR6swHwYDVR0jBBgwFoAUvUxx\nTvztZbcDfJj7UL5HgfCnAsgwGgYDVR0RBBMwEYIPd3d3LmV4YW1wbGUuY29tMA0G\nCSqGSIb3DQEBCwUAA4ICAQBpfHUaVuA+GqLC49DZbpOkzcgsNTpFLqjc/ztQje9o\nXBj+M1PlBjbC0DsUGiJ+MLdS4JTsmeWvNd0lBy+X+P+YfjmZ5UcHY1b5vRpW8SGA\nNULkaM7jXBQkjsZ8kIj4k0RWW5UZ/h7n/sqAnrXzKc+ajjG/dZsxJgv3th6xCx46\nx70M+iTq3Em8e8s0aZKqCTpfBWtDvweKFX19+fTdVnNXCSChprCc2pPqkFYbs2m+\n2sSfU5OtmP4ExfliqGnpKuQI7hhLFxPIArp+c2M8ZR7k9TuGdS1ZSrGZKqnsVTRc\nx2bEsPxefkJELE02vKMDwg0pAC8WeAmOpcR2Yt7zUW73XoK2xWUwgoLfeAf/tdwh\nuYp2oEpKepHL6kOpezK7aE1aTIpNKGbP3H7x8UmKD6H3cxn5D/yjHrLOGesBoRJp\n87GJCOE613HRKNZlQat4DA28mGjRnFeZ69IiG1MVLoBnHWKU7l71NFiTIxLpLh/G\nWZUeab1gSrcSZqUlynY96ugSLKXKfGq4y+S4A70+Aaol58JQFtF1UZL30cAgT+XT\nyUdWOd4FDwcGg2TQgCtJQryaD8yyTX9pCWHIdt2Pxl6OT1vUAgD1KafjUHVYB9+m\n5+wGdPlC6WrJN5++642buI0rjPE8H8acLhtB73tLVhLCJMNOB2MFX0WwxAE6g+vw\nEQ==\n-----END CERTIFICATE-----",
    "expiration": 1567182713,
    "issuing_ca": "-----BEGIN CERTIFICATE-----\nMIIFZDCCA0ygAwIBAgIUPHF5fjq5+L66Bp/rCVR0+f6sl0wwDQYJKoZIhvcNAQEL\nBQAwODE2MDQGA1UEAxMtRGF5dG9uYSBUZXN0aW5nIEludGVybWVkaWF0ZSBBdXRo\nb3JpdHkgVGllciAxMB4XDTE5MDcyOTE2MzA0MFoXDTI5MDcyMzE2MzExMFowODE2\nMDQGA1UEAxMtRGF5dG9uYSBUZXN0aW5nIEludGVybWVkaWF0ZSBBdXRob3JpdHkg\nVGllciAyMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAxHkjFBw1utW9\n9xouOR3T0zAg3aLVjzoDcd/L1UlQ6VFHgFK1nDhCuUB4sl4XuGTo2Ja8nYL048pN\n2wNZ4+N61MOYj9B+dD5Zea8DOeObKUNS55Dor6ztgyItnKsspxdYwyYVqr02XOTR\nPUqMuMy3PkVth9RFGEZZC8fMAGgPSVmQND8Kz7Zse+9emOze7vl1sEdVbgJQ8WvU\nJDpdkzmAYqqw4qhibfvtPrMwk6v8N7m5JanBPnxl5vZEReIlHQkcNIqyHBNZeu3m\nFBcp3BF9yxFJFUayGcTIpCWvl2DJZaAcNJHtijyv+ubyZBhEWpgHavtdFv1Rjs/e\nd4VNYmxywxTdkEAWsHK2j0l1labSbt2oUhBFk1Z+wqFzsD70J7Dw1LppfOBjcieM\ns2Dx21yAsab0oJW81cNeye3bDRmwc9vh0++zG76H4IJqE8QYS0CVcDMQKZMMulkJ\nFkCjHaQwbwoisUj5p1KdrZfXBES6Q4vglZO1MsYtn0mqD+cndY52FO6fk7h52ntX\np3tY5LovTJx3I2Apbj+c1eWm+fZfPSmR2u2Xkfe1SEURtoavPUJprPzIxH8qLWaM\nTvzWQAVE0c3AhWKfCfWRIduve3sakw6kOTf4jmTLa+M9QOOEOifZuHOHH/jgI5He\nHc4iasqstDPiRympeoTBpGwTQtSxxPECAwEAAaNmMGQwDgYDVR0PAQH/BAQDAgEG\nMBIGA1UdEwEB/wQIMAYBAf8CAQAwHQYDVR0OBBYEFL1McU787WW3A3yY+1C+R4Hw\npwLIMB8GA1UdIwQYMBaAFBjGDCozLsEbZ/2IDQhYla3+E3JoMA0GCSqGSIb3DQEB\nCwUAA4ICAQCdCvSEwNDUI2GnW5FPxQyvgIF6reW8Y3pWsH1nCKUAA6m7ZR/H+O5Z\nS6Fsv9BPaKR5Zvy6K8DQKJOrDw+lKywraFfg8eVJ8ig/ktpRwD1JM82vbK6G75+7\ntTCtsyu6asyWaQbVEvx/hYw89UQbkY76zi25E7P01srzGJUZ1X656MCzDzpb027s\nPZpj3cro6qzi2pxvdC7xEpZf8x1r4RDqjk/Jf8Q5BY2nEZSlBsOB49FnoxoCQC3W\nReNcWxMZOCiXF1ZxhXgTAUnF6KckkWeSy6/t9e1CEJUHucOvUCfptgtzTy6nYT3b\nQ/+BmtVtQP0WZnT8j1RtCrSRe0sDijdM19iO/XsUDWHCIALFqMyIM3dQLg2khHoi\nve1ACUWbXqdiob38nAtCKkMWvGxKKwOkgzYf7DodOGsQWg+SXB12tuvoyyhz3rtU\nSE0xn+eNxqiX/J80pXytC3IxcooaOMwX60ZwpYPa/DlZcKwgrxvKXvvVTf9pAseh\nez0wM89j7SS1usdpb+5XnArL5NFm8DuGNcmP8WBt9tcsN8wmqMNJDibNY7rINRR8\nv9yxTMoOsnYKv7Nj6uxjbbgwC7EKGwAetB1nZMX0Q0wBfE898PlJ4EYY8BjS0KSy\nbBaUAy2osOAQdUa6F73/sG3eZQnejtUNo+luq+p6RI4wOkpJXXuaPg==\n-----END CERTIFICATE-----",
    "private_key": "-----BEGIN RSA PRIVATE KEY-----\nMIIEpAIBAAKCAQEAuaOUdJHtzATZ3ao4+o2rSWQlu9kOwMs1gRjpTTXc454LISve\neQTW/qkdFVu0VoX4+04y7FBN/giAIk3T5zN1QlxVnM7K78w/bZSZzdrOKoJEGpIh\nV0kwiZtv+Nekzyw5hJzZqtqNPJARISrWxTf7O7cjiPbNyY5dquUToY2aSDJBzhqz\nNRsxM6Syl8wIcM8TBm/Dsq+lJYfGdVevZ4j6UXkATd2wOCnswbzTR3S0VUxdCDnE\n6+c4yUt28Qu3SvaFT9OGVXegw5n8G6Dgs/PHyqNQJziBU1uXCFWcUtqcBo9X39BV\n4qBvZKXs6b3m4WvG1+Rqadqu+W+dhsjVAfVySwIDAQABAoIBAC2xQMIshQ55hzKT\nSnEJW8a1ur/w3jvACMxc2Ffj0RnJdc3VYW4CLfUCpSDzsIC3eyBIECqwXXIQn5FR\n/L1kohESbxQopjS93kLXl7/egm5eH+s2WrSEVEkalEX4th00Mngcr0rpfmgQwdab\nF7/1VoZNPpbgwKhCvXVp6xoRo47vO91FhG2plAmO/A1X4elIA1rGfnx2x2OQMrXT\nQH0yKswN+ZuoTn+2vTWXeoep8DOE8XwcR8fL2ZI9XMg6sXqKMqPdquLF6MVUw3uO\n/B12u/fibjzx8o2BaeYIWFRqNinNRGYlTLqFuUSHGhraFXf0shJUcn+g7bcG5U7N\n0QWHXoECgYEAwv7NfIbfznFpqM4mrFnS++5ik18jJ796fnbspqqAhAJq967HiDlw\nQQMo31fvT54mgSKJZDp5iC6kxpBmi085QT9ZMkT39TTqHObpiuvW2gL8+uak7pQ9\nKeAeTqoa/CWSxExhEPFl7fWpV8QCj1xTwXXWzLhGhiY5OoC9PF8UNgsCgYEA87dt\nTsCsQijQehhMi/uoXZOF5G+2xSA660/xdua6qs2viGWrhdWaJ3ZTlPuXO8d94+EG\n4xyvKfYIMb2rADGz4kGTL1F5WGDoxN9T6hB/rm7BU3gGBS2rlY4hNNuqvwgVaPE/\nU+0sq5SXxBNuPXHbUU4Ule6XpTsu9E2Nx/ienMECgYAC+O1a85dfxzzMFPBj+i6M\nJpMcGfwoM/QDD38F/11cJclJo0FpYy7B3vF1jhqYxRljKIqdm4KUv9lFKZhWkUuX\nIgcTDBgXhcn3zNFMi9HHmvoOPQvQkzPneoIbwt4Mb+ov0dY88uER4ofFTbiYRNkF\n/uzaTAjPLK/8o0+/JtfhBwKBgQDJNRRfQh50+HE1e74mi3uy1cpikABauoMqJnP5\nb/+IaAuVFisHcRO1pLDYfOWcitRaQDuJYPMUN3UIa8gzftU95Fl5ZVBDMK67ao1C\n3qArCHE/UgXWXKAd9ptfokNTN39FhnZ7+YE5npG1ZT1MKSWh+E5ygepclYHsW+LD\nx3RbgQKBgQCL6VIDBP+uJzuDajVAOiasUSYx/BK+icUSo/oq6MvFRctvcRDVMv+8\nZxnDXDaDYU88/n3GwMxt2NyHHrr5zPb0zVm1wcVKfplPZ1b6HtNnOuu701/Nqcp+\njKatMksdyonSH0+i/liTKj0nriE643uMuQgVvo4SFx9knSdD/869eg==\n-----END RSA PRIVATE KEY-----",
    "private_key_type": "rsa",
    "serial_number": "4a:ee:d8:86:17:cf:9d:17:f2:af:7d:09:05:53:8f:83:90:35:03:d4"
  },
  "warnings": null
}
`
	testPkiIssueResponseMultipleDomain string = `
{
  "request_id": "198c0ddd-5bdf-98b1-ac7e-70aa5cda8e0c",
  "lease_id": "",
  "lease_duration": 0,
  "renewable": false,
  "data": {
    "ca_chain": [
      "-----BEGIN CERTIFICATE-----\nMIIFZDCCA0ygAwIBAgIUPHF5fjq5+L66Bp/rCVR0+f6sl0wwDQYJKoZIhvcNAQEL\nBQAwODE2MDQGA1UEAxMtRGF5dG9uYSBUZXN0aW5nIEludGVybWVkaWF0ZSBBdXRo\nb3JpdHkgVGllciAxMB4XDTE5MDcyOTE2MzA0MFoXDTI5MDcyMzE2MzExMFowODE2\nMDQGA1UEAxMtRGF5dG9uYSBUZXN0aW5nIEludGVybWVkaWF0ZSBBdXRob3JpdHkg\nVGllciAyMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAxHkjFBw1utW9\n9xouOR3T0zAg3aLVjzoDcd/L1UlQ6VFHgFK1nDhCuUB4sl4XuGTo2Ja8nYL048pN\n2wNZ4+N61MOYj9B+dD5Zea8DOeObKUNS55Dor6ztgyItnKsspxdYwyYVqr02XOTR\nPUqMuMy3PkVth9RFGEZZC8fMAGgPSVmQND8Kz7Zse+9emOze7vl1sEdVbgJQ8WvU\nJDpdkzmAYqqw4qhibfvtPrMwk6v8N7m5JanBPnxl5vZEReIlHQkcNIqyHBNZeu3m\nFBcp3BF9yxFJFUayGcTIpCWvl2DJZaAcNJHtijyv+ubyZBhEWpgHavtdFv1Rjs/e\nd4VNYmxywxTdkEAWsHK2j0l1labSbt2oUhBFk1Z+wqFzsD70J7Dw1LppfOBjcieM\ns2Dx21yAsab0oJW81cNeye3bDRmwc9vh0++zG76H4IJqE8QYS0CVcDMQKZMMulkJ\nFkCjHaQwbwoisUj5p1KdrZfXBES6Q4vglZO1MsYtn0mqD+cndY52FO6fk7h52ntX\np3tY5LovTJx3I2Apbj+c1eWm+fZfPSmR2u2Xkfe1SEURtoavPUJprPzIxH8qLWaM\nTvzWQAVE0c3AhWKfCfWRIduve3sakw6kOTf4jmTLa+M9QOOEOifZuHOHH/jgI5He\nHc4iasqstDPiRympeoTBpGwTQtSxxPECAwEAAaNmMGQwDgYDVR0PAQH/BAQDAgEG\nMBIGA1UdEwEB/wQIMAYBAf8CAQAwHQYDVR0OBBYEFL1McU787WW3A3yY+1C+R4Hw\npwLIMB8GA1UdIwQYMBaAFBjGDCozLsEbZ/2IDQhYla3+E3JoMA0GCSqGSIb3DQEB\nCwUAA4ICAQCdCvSEwNDUI2GnW5FPxQyvgIF6reW8Y3pWsH1nCKUAA6m7ZR/H+O5Z\nS6Fsv9BPaKR5Zvy6K8DQKJOrDw+lKywraFfg8eVJ8ig/ktpRwD1JM82vbK6G75+7\ntTCtsyu6asyWaQbVEvx/hYw89UQbkY76zi25E7P01srzGJUZ1X656MCzDzpb027s\nPZpj3cro6qzi2pxvdC7xEpZf8x1r4RDqjk/Jf8Q5BY2nEZSlBsOB49FnoxoCQC3W\nReNcWxMZOCiXF1ZxhXgTAUnF6KckkWeSy6/t9e1CEJUHucOvUCfptgtzTy6nYT3b\nQ/+BmtVtQP0WZnT8j1RtCrSRe0sDijdM19iO/XsUDWHCIALFqMyIM3dQLg2khHoi\nve1ACUWbXqdiob38nAtCKkMWvGxKKwOkgzYf7DodOGsQWg+SXB12tuvoyyhz3rtU\nSE0xn+eNxqiX/J80pXytC3IxcooaOMwX60ZwpYPa/DlZcKwgrxvKXvvVTf9pAseh\nez0wM89j7SS1usdpb+5XnArL5NFm8DuGNcmP8WBt9tcsN8wmqMNJDibNY7rINRR8\nv9yxTMoOsnYKv7Nj6uxjbbgwC7EKGwAetB1nZMX0Q0wBfE898PlJ4EYY8BjS0KSy\nbBaUAy2osOAQdUa6F73/sG3eZQnejtUNo+luq+p6RI4wOkpJXXuaPg==\n-----END CERTIFICATE-----",
      "-----BEGIN CERTIFICATE-----\nMIIFVTCCAz2gAwIBAgIUGbCWtfBfyDS+RYLu7zmPXBn4QIIwDQYJKoZIhvcNAQEL\nBQAwKTEnMCUGA1UEAxMeRGF5dG9uYSBUZXN0aW5nIFJvb3QgQXV0aG9yaXR5MB4X\nDTE5MDcyOTE2MzAzMVoXDTI5MDcyNDE2MzEwMVowODE2MDQGA1UEAxMtRGF5dG9u\nYSBUZXN0aW5nIEludGVybWVkaWF0ZSBBdXRob3JpdHkgVGllciAxMIICIjANBgkq\nhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAr3yYPikSzxUx80Aj7tQl99/aISCpRLPu\n2Jt1wGy7YuDSgBQzUIE/UU54qlvgFzQWJkixm7+Nf70EscB/jmgZdhJiR6IwCG/2\nj/JH3mFCcyJiGB/iR7YTNUffi0s8DrnDtMwR1+olZeUGWgrzN593TK1qWtZqo4lw\n19syPzES+1KvmfH4cuQJU6JbWd2PI9gfP6jQP4+sj3D1tQnKzVum038O0rEO5YgS\nwy61hlvU9xIh0Hd8kZZSTr8bi4YIwOg0vb1XeXMNw/jZN+qkxR/18W4rncETc4om\nPpAqzbEEHqii984OIaSesp7C8EERSRIbSc7AbReaVD4GtWElBODQ5qUPWm8ujBD/\nP9390e6EPTPWAmAKZoxQBeTaMmctaVu+pjq5wje9yT59I/0NXlPvs6eLeWomxA3t\nUnrDEbV5PYiSs297b+4BMpGC1GW1HELAhnHnuEjvAwBPJipKEGB5PiVAFZd8kesf\n1ylPRu8bGsdfPca0a4Zljvhq2/CAG1sHLC6DKIoXz2+z2VVPZwpKb9RpzNvEpf6J\n5ACzpUE1u330hnMJyWkg3aIO2zFTmpGGXUeKVM3ZUrqbJDRunKzt2erBbhJt5gwI\nzqcMXW3xY+a0vaYTLi7/uP3WbfVH7oDQWr0XWhiD8QZMaX3bKgfz0BADVJJ5H7ty\n0bulASy55KECAwEAAaNmMGQwDgYDVR0PAQH/BAQDAgEGMBIGA1UdEwEB/wQIMAYB\nAf8CAQEwHQYDVR0OBBYEFBjGDCozLsEbZ/2IDQhYla3+E3JoMB8GA1UdIwQYMBaA\nFAg0PfrOYyUDFQQnRK24dlLxB7KgMA0GCSqGSIb3DQEBCwUAA4ICAQBahA59ak6W\n29VwuzF3UcwDjVDLD9TJ2yCz0tBiKGgs76OCfJPMnIkc4eTG/n0B4QnCTyZKSPsF\nGiLxPvdU4ocK2ZrGv6yAJNG4oNSqF7rq50zbfbiDTFoXZRsgksmnsQiI1WhRnb5s\n2O+dznVZZcu7f+DNfRghqyepMwMTheDWmnLK2tVH5WWZK4TxJMLkK51c9ho/UOuy\nmTYmN7P4TSJ7QF5qail9EMabI6Kysc2huJaiNsR6l3+FCqz3zPtq9Kd0Nkw+0fhf\nBuM1QjEnmB5OX0QuT76V+qLJlt7aUcLmuHGuIgVuplF7nKdKLTAeCzxdScz4bDZ1\nFf+5tVlLuoCUgJqERuN9HREyA1+uWkPDTm5Wl8xHzj6GzN5/9v/P0M5ePXrUNGYx\nHAwmsBeZDrAhD6Zq0YzHiHKkKif4HsT6jzPRLsdpJ2z7dQFl0LaH5rDfycGOTS89\nb8CMPZiz8+HEhgAEylKQRwCQqAXjDWGLYzDtq7xs7csvvuuLQdgY29GxWQNknrwz\nJLoW4dgBFNyj7Qcs4k9aW598b9TC08KKcMbEXhzfB0NDHWzq7172w00ulRy5sNMH\nEzcMkMpzDyMJxDDkdnix3thN0N+p5K2tG7nG3mtRDbn6RAlTJMMGihaVv2Mc1SGu\ntl5GoCqKBvvyj6u59NgoDTMlAYJ8DKlNNw==\n-----END CERTIFICATE-----",
      "-----BEGIN CERTIFICATE-----\nMIIFRjCCAy6gAwIBAgIUBToj8szGWnPPsjUz8XeOcAj59/QwDQYJKoZIhvcNAQEL\nBQAwKTEnMCUGA1UEAxMeRGF5dG9uYSBUZXN0aW5nIFJvb3QgQXV0aG9yaXR5MB4X\nDTE5MDcyOTE2MzAyOFoXDTI5MDcyNTE2MzA1NVowKTEnMCUGA1UEAxMeRGF5dG9u\nYSBUZXN0aW5nIFJvb3QgQXV0aG9yaXR5MIICIjANBgkqhkiG9w0BAQEFAAOCAg8A\nMIICCgKCAgEAt9wd9d1LQHDgneoMSMqU8sN/t+AeC4vDIcvA1DVr8gIwF745qp7H\n4W0bu1nzB4sPMxIumwzuw9m+mxXo4zcbMmYUyowcx2nhH3MNaF6hX74eMeMaPAVr\n4lMsMK3swvjvFywwCFtSgvsWbulDgAJlCf3PKKXtbqGPcn7pP4cPIifHN9drPoR5\nO2wfy0JuE6mg3iYsy0Bl9mQixnsQZO+WWPbW853iTctCIaPq9VE6H0T9VqTujIw8\nldOwrwkUDOSh3IEfNBRLRoanpSvg4ZktdF6JKNqqtBHE6pOpGX2LuR2pV+S7ylim\n4pJaCtKj35jhMLpWxXARx+5ejLeAHv0Ye4SJhUInaaWaDiDyR+eShKpKkhjKaME7\n0DKyzdyZAQDF5hRaYCHHBodZrkyZlGOx6cE8fH0icRqJ9uzRwTk7keJ6HACQcYDN\nd4zfhoUmPxkxPQaMf6pTJk4ABtFPw9aktFcJ4w+jWLD/eZZKkwNhjy3NOUXVV0aj\ngFBPcQ8F9rf0pPfNR8NMpuw0Y7BkJovv98mgTFTFUqYaR0BsVuEVBFV796s663nK\njq0XO3nk6YLdOG/dFJBtsxFkdr0PpRR7bQXs7FNMkAgqGytDVttbZGqE9Pme7+B6\nXyiPVQNkb6fZIxQxoaxzhMoOYCYJXqDVHs5VKKraLFlhmA6C5IrJOfcCAwEAAaNm\nMGQwDgYDVR0PAQH/BAQDAgEGMBIGA1UdEwEB/wQIMAYBAf8CAQIwHQYDVR0OBBYE\nFAg0PfrOYyUDFQQnRK24dlLxB7KgMB8GA1UdIwQYMBaAFAg0PfrOYyUDFQQnRK24\ndlLxB7KgMA0GCSqGSIb3DQEBCwUAA4ICAQBsAOhZk/J/ClOjp1Ktk8SPEOx3mttF\nhV3KTA7Lpw9FZcOfUwUTbwe3P1mnyHI1oNfxw1TqYETlYOsC3PKBEiCoL25JM8Fk\nyuZeqgBGCyqx9HOQNsLc2QC0CsnSytMGCToLLXlYW6bSIoGx5ZXty+Sa6nBWX98q\nOJwL0kLO8BUoZ9n/+URYQ9tJpNj7ik64v5FltUq9qsq2Ki0toINWkKUbIxJ59rwf\nVDFnJ5KASf4HkVKL7XfVfCD+aqbrj+IdzL+zGhg5t6oWB7Q973+F2zMmcWE4z+84\nVBsyl/DW4Zx73xk7c2avKp1JVqH8aVRNQKWqXk1WW44fAAFt5lglgRZYFRdfKXqc\nkcSrZvxjzUDyp+d9ihj/RYubwYBUVy7BAbjzyzjJ7mmPuOQkeeTZIEay0ZJs8kty\nqLvEX2qMjbVivp14ezKw3GYLbNw5s9evmxFRMJQa5QTZUKR0W8HDJllcVcLG9IWQ\n8wUyu2evId06Pg+cikIrE2PJ0WwadK+kLo22u2RgmuwIfOZrZQaZaXMaQc+P5wot\nHzlQCIvAhvAwj+T3s6O4OrYhq39tKGCe/X9CJ+j+qYUJJ5l8VrWeHNEi2Kjjmmos\njj/Eyj+Ofe1YGOTUUVsZ5cs2Y1rs9ep3rhqNN4zI8jNax+RTjJtLNI3leTi5gV71\nevoHW7vpj9w4LQ==\n-----END CERTIFICATE-----"
    ],
    "certificate": "-----BEGIN CERTIFICATE-----\nMIIEnjCCAoagAwIBAgIUKhBDXRw8eWzrc4SRGkYCIGPJXgEwDQYJKoZIhvcNAQEL\nBQAwODE2MDQGA1UEAxMtRGF5dG9uYSBUZXN0aW5nIEludGVybWVkaWF0ZSBBdXRo\nb3JpdHkgVGllciAyMB4XDTE5MDcyOTE2MzUwNFoXDTE5MDgzMDE2MzUzNFowGjEY\nMBYGA1UEAxMPd3d3LmV4YW1wbGUuY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8A\nMIIBCgKCAQEA1Okp878HvyhUOHlhLeVm7k4GTW8UR4+pjjGnoIx7jndk+TeoMjm9\nFnz8oppb7NIYgpgMn6cQtq3fhWejVFVtMBYKXoNJvMZj5HVEqMi//OFzKtpUeK90\nVDwYsASmqmN3EXh7VmpseE6pm9//blf/PJG5nFsSyFbOEavo3Jj/ZZrlCmIdNNaK\ntn4YTYh1VvE9niB4hS6NEirPuCpTEjsqg/pCfHXIOrsa8+eyEj/hLLtCzGJG7IFP\niT8p5rlxqr5Kh5IrFfqn4gkgorAP/X8qCIRqfW4nFe8oAdcuZhjsvc4r0qwKOGYM\nObENonp8a4WvrIBRJEHwSCE37/8VjjoYCQIDAQABo4G9MIG6MA4GA1UdDwEB/wQE\nAwIDqDAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwDAYDVR0TAQH/BAIw\nADAdBgNVHQ4EFgQUn9NbiWCcfDx2Mjh86WKGUelLCB0wHwYDVR0jBBgwFoAUvUxx\nTvztZbcDfJj7UL5HgfCnAsgwOwYDVR0RBDQwMoIPd3d3LmV4YW1wbGUuY29tgg0q\nLmV4YW1wbGUuY29tghB3d3cyLmV4YW1wbGUuY29tMA0GCSqGSIb3DQEBCwUAA4IC\nAQBft7JaZS4k2bg6zw8ETwe+JMhc+kCAoWz1GUPgdHm7QQ/k0yYNYzseMDI1w4OB\nFADnS7mGl7NO2dvxsOsYUFWr1e6S4jBljvy33ZlwuQj6gUa6DUu+NZdCyqAQGftt\nG9klfzErsWyjU8yNorsM1v5Hm8O2ZC59wzgdXe9n51w0z9t07ryqK4SygDkyMpP8\nuMMXouPyPXUPhT7IjEjAqDnC1qxgzXFgV6oUNkCRpfL6UG5tTZZ3cPNG2fHvWmH9\n6DFXhRyuSiYtEdFhJXK9CU8a9gPGczegXdCiW83zwlAvfajxSsuYmc/eX4TzHjuf\nSVUfQOyz/SCrSSOL2SMzXRkOO/HDA9iZq1WcLVIOWqLNYZ1UmSwgnpGQtGjCopm3\nzIPe5hyJ0mpx2TywEjxoo/l2M9UMlSP+bByIuTyNyZkq8l0ytePfTgqsaGxqsdNg\nwWf9GYB9+g2SDTaOillrlwGboF7O1JN0SYs/JsO23NQvwcMuoq7f66v7K4oEOfwl\nV0anwoBUlp4KMY4AOoH9O4JR6pCiW//MHwzoXH82AzrjQ+y0LR7HqGgDuWy3RG2R\npTZVf9eSTEVsGmA7fV8Fb2EtHac/IOI9uvndrGnjaX/o4dnkUzR/kEcnFhppsrzd\nZOo310BBZY2/VRre6DI8kcOxjV9ipafxb9nsBmmrYkRbqQ==\n-----END CERTIFICATE-----",
    "expiration": 1567182934,
    "issuing_ca": "-----BEGIN CERTIFICATE-----\nMIIFZDCCA0ygAwIBAgIUPHF5fjq5+L66Bp/rCVR0+f6sl0wwDQYJKoZIhvcNAQEL\nBQAwODE2MDQGA1UEAxMtRGF5dG9uYSBUZXN0aW5nIEludGVybWVkaWF0ZSBBdXRo\nb3JpdHkgVGllciAxMB4XDTE5MDcyOTE2MzA0MFoXDTI5MDcyMzE2MzExMFowODE2\nMDQGA1UEAxMtRGF5dG9uYSBUZXN0aW5nIEludGVybWVkaWF0ZSBBdXRob3JpdHkg\nVGllciAyMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAxHkjFBw1utW9\n9xouOR3T0zAg3aLVjzoDcd/L1UlQ6VFHgFK1nDhCuUB4sl4XuGTo2Ja8nYL048pN\n2wNZ4+N61MOYj9B+dD5Zea8DOeObKUNS55Dor6ztgyItnKsspxdYwyYVqr02XOTR\nPUqMuMy3PkVth9RFGEZZC8fMAGgPSVmQND8Kz7Zse+9emOze7vl1sEdVbgJQ8WvU\nJDpdkzmAYqqw4qhibfvtPrMwk6v8N7m5JanBPnxl5vZEReIlHQkcNIqyHBNZeu3m\nFBcp3BF9yxFJFUayGcTIpCWvl2DJZaAcNJHtijyv+ubyZBhEWpgHavtdFv1Rjs/e\nd4VNYmxywxTdkEAWsHK2j0l1labSbt2oUhBFk1Z+wqFzsD70J7Dw1LppfOBjcieM\ns2Dx21yAsab0oJW81cNeye3bDRmwc9vh0++zG76H4IJqE8QYS0CVcDMQKZMMulkJ\nFkCjHaQwbwoisUj5p1KdrZfXBES6Q4vglZO1MsYtn0mqD+cndY52FO6fk7h52ntX\np3tY5LovTJx3I2Apbj+c1eWm+fZfPSmR2u2Xkfe1SEURtoavPUJprPzIxH8qLWaM\nTvzWQAVE0c3AhWKfCfWRIduve3sakw6kOTf4jmTLa+M9QOOEOifZuHOHH/jgI5He\nHc4iasqstDPiRympeoTBpGwTQtSxxPECAwEAAaNmMGQwDgYDVR0PAQH/BAQDAgEG\nMBIGA1UdEwEB/wQIMAYBAf8CAQAwHQYDVR0OBBYEFL1McU787WW3A3yY+1C+R4Hw\npwLIMB8GA1UdIwQYMBaAFBjGDCozLsEbZ/2IDQhYla3+E3JoMA0GCSqGSIb3DQEB\nCwUAA4ICAQCdCvSEwNDUI2GnW5FPxQyvgIF6reW8Y3pWsH1nCKUAA6m7ZR/H+O5Z\nS6Fsv9BPaKR5Zvy6K8DQKJOrDw+lKywraFfg8eVJ8ig/ktpRwD1JM82vbK6G75+7\ntTCtsyu6asyWaQbVEvx/hYw89UQbkY76zi25E7P01srzGJUZ1X656MCzDzpb027s\nPZpj3cro6qzi2pxvdC7xEpZf8x1r4RDqjk/Jf8Q5BY2nEZSlBsOB49FnoxoCQC3W\nReNcWxMZOCiXF1ZxhXgTAUnF6KckkWeSy6/t9e1CEJUHucOvUCfptgtzTy6nYT3b\nQ/+BmtVtQP0WZnT8j1RtCrSRe0sDijdM19iO/XsUDWHCIALFqMyIM3dQLg2khHoi\nve1ACUWbXqdiob38nAtCKkMWvGxKKwOkgzYf7DodOGsQWg+SXB12tuvoyyhz3rtU\nSE0xn+eNxqiX/J80pXytC3IxcooaOMwX60ZwpYPa/DlZcKwgrxvKXvvVTf9pAseh\nez0wM89j7SS1usdpb+5XnArL5NFm8DuGNcmP8WBt9tcsN8wmqMNJDibNY7rINRR8\nv9yxTMoOsnYKv7Nj6uxjbbgwC7EKGwAetB1nZMX0Q0wBfE898PlJ4EYY8BjS0KSy\nbBaUAy2osOAQdUa6F73/sG3eZQnejtUNo+luq+p6RI4wOkpJXXuaPg==\n-----END CERTIFICATE-----",
    "private_key": "-----BEGIN RSA PRIVATE KEY-----\nMIIEpAIBAAKCAQEA1Okp878HvyhUOHlhLeVm7k4GTW8UR4+pjjGnoIx7jndk+Teo\nMjm9Fnz8oppb7NIYgpgMn6cQtq3fhWejVFVtMBYKXoNJvMZj5HVEqMi//OFzKtpU\neK90VDwYsASmqmN3EXh7VmpseE6pm9//blf/PJG5nFsSyFbOEavo3Jj/ZZrlCmId\nNNaKtn4YTYh1VvE9niB4hS6NEirPuCpTEjsqg/pCfHXIOrsa8+eyEj/hLLtCzGJG\n7IFPiT8p5rlxqr5Kh5IrFfqn4gkgorAP/X8qCIRqfW4nFe8oAdcuZhjsvc4r0qwK\nOGYMObENonp8a4WvrIBRJEHwSCE37/8VjjoYCQIDAQABAoIBAQDJ8kb6jY15gXUx\nA+BrOhZBnvxXYi7oGZoH541JuTZQ0WqTAHmm+iEiPXcbfDIJFNZuuG3w2PP/cjh7\nPuwqx8SDQcSgFQNR7RM+1QRE2/VOlUE5ulE5D6LVaxM3kZHMN//uMEs8kkFEc8ho\nszSCozDTcJ2PcssD/2ICXP7Ijs5gvakYO1vdsN9+IOzVG8D+BWzqDuFynuv2VFGa\ncZdJRJMUJZqNBADhLAdsJFZxylRRv7GT0X5n5BjDM14Fb1P+br9ZpUzSKrydyBwV\nqheuoAYe6h+DeL9Rzc8oI8HRYh0+u1N2WrYt0FD9Yirdj4PcQXiddNXwvmZ2rLPK\nIZN9EaQBAoGBAPhqBi4unNLQ0YpU6x/omcD21DBfkax6+blQlUEH9cMrsY6U9qVT\nBBvyyi20i86l/jdWAK1Ok73BubvB2wpqIhrPtByJ2/80fNxCqxK1lWI0U+mMKH4S\ntVoph4lo5I5PJkOIQLycLJx9T2gxughxtkQhBXlL/+2L0aT+yMOurMJBAoGBANtp\nl6xFY3KypZ2N9yUCYjcdT9//daklMEfWU3FbrGZ16HSz5pAkPc80/XMklG1XlY2m\nt5SWP93Fyn8y1zLec8EM6DPLkVMn38LwUJQt/ne7nFF6GLOvVPsQVRKSU9RzP+EJ\nHn7ForqoHWF5PfjbXufDur6moZt2HT0SpZ0R+tPJAoGAEL/9aLHF60UfS+eL7xvc\n+jDqf9SB2xJzsjYnyjnCLYXNtCKBOwaM+WF2lnxdDPMOYCbRZt4sghgE8Q8SOPKN\nGCe3KlF1XxDn9mYcaOeLihKjMdU8ibuzNMAmHnLPLnVRzC3sx4r0Sxz79LedpqIc\nOx3K47HnMNpDqY9wdBlcFsECgYA0u6kXX0nqfCMvvboDbBI82s+ir1wQ/f4fldRS\nL009BuOKgN5OEFfGoB61+Lmvmdg4xjPjA0VwQKRNc+OitzIs2LRKFofj63Zs/KLx\nKii5kB6eunCLZv1Opfs8TmzVZ6mXpUBuCYP1xofhMGmDkP27SCBux8+ZdIbMcdnZ\n6UNWeQKBgQDAYC0SA4XLSCkfw2vgqPAzCsVZnTwsG1fX8EP4lMKXuD3gO//2N1zI\nBMysZdhPsYIqXE9eVF3qjv2IhZLSyQcRUPeK34GPYBtt9iFzCvAOqcdV9hvGDGFj\nzRs7wPa/18Cg+cACXs2gkhnFnG+0PRTH1ouIKpWOuoi31viqOsWRUg==\n-----END RSA PRIVATE KEY-----",
    "private_key_type": "rsa",
    "serial_number": "2a:10:43:5d:1c:3c:79:6c:eb:73:84:91:1a:46:02:20:63:c9:5e:01"
  },
  "warnings": null
}
`
	testPkiIssueResponseWrongRole string = `
{"errors":["unknown role: wrong-role"]}
`
)

func testHandler() http.Handler {
	return http.HandlerFunc(
		func(w http.ResponseWriter, r *http.Request) {
			if strings.HasSuffix(r.URL.Path, "wrong-role") {
				w.WriteHeader(400)
				fmt.Fprintln(w, testPkiIssueResponseWrongRole)
			}
			if strings.HasSuffix(r.URL.Path, "correct-role") {
				decoder := json.NewDecoder(r.Body)
				tstr := struct {
					Alt_names   []string `json:"alt_names"`
					Common_name string   `json:"common_name"`
				}{}
				_ = decoder.Decode(&tstr)
				if len(tstr.Alt_names) > 1 {
					fmt.Fprintln(w, testPkiIssueResponseMultipleDomain)
				} else {
					fmt.Fprintln(w, testPkiIssueResponseSingleDomain)
				}
			}
		})
}

func TestSingleDomainCertIssuance(t *testing.T) {
	var config cfg.Config

	ts := httptest.NewTLSServer(testHandler())
	defer ts.Close()
	client, err := testhelpers.GetTestClient(ts.URL)
	if err != nil {
		t.Fatal(err)
	}

	keyFile, err := ioutil.TempFile(os.TempDir(), "pki-test-")
	if err != nil {
		t.Fatal(err)
	}
	defer os.Remove(keyFile.Name())

	certFile, err := ioutil.TempFile(os.TempDir(), "pki-test-")
	if err != nil {
		t.Fatal(err)
	}
	defer os.Remove(certFile.Name())

	config.PkiPrivateKey = keyFile.Name()
	CertFetcher(client, config)

	config.PkiIssuer = "test_intermediate_authority_T2"
	config.PkiRole = "correct-role"
	config.PkiDomains = "www.example.com"
	config.PkiCertificate = certFile.Name()
	CertFetcher(client, config)

	singleDomainCertNoChainData, err := ioutil.ReadFile(certFile.Name())
	if err != nil {
		t.Fatal(err)
	}

	keyFileData, err := ioutil.ReadFile(keyFile.Name())
	if err != nil {
		t.Fatal(err)
	}

	assert.Equal(t, []byte(testPkiSingleDomainCertificateNoChain), singleDomainCertNoChainData)
	assert.Equal(t, []byte(testPkiSingleDomainPrivateKey), keyFileData)

	config.PkiUseCaChain = true
	CertFetcher(client, config)

	singleDomainCertWithChainData, err := ioutil.ReadFile(certFile.Name())
	if err != nil {
		t.Fatal(err)
	}

	assert.Equal(t, []byte(testPkiSingleDomainCertificateWithChain), singleDomainCertWithChainData)
}

func TestMultipleDomainCertIssuance(t *testing.T) {
	var config cfg.Config

	ts := httptest.NewTLSServer(testHandler())
	defer ts.Close()
	client, err := testhelpers.GetTestClient(ts.URL)
	if err != nil {
		t.Fatal(err)
	}

	keyFile, err := ioutil.TempFile(os.TempDir(), "pki-test-")
	if err != nil {
		t.Fatal(err)
	}
	defer os.Remove(keyFile.Name())

	certFile, err := ioutil.TempFile(os.TempDir(), "pki-test-")
	if err != nil {
		t.Fatal(err)
	}
	defer os.Remove(certFile.Name())

	config.PkiIssuer = "test_intermediate_authority_T2"
	config.PkiRole = "correct-role"
	config.PkiDomains = "www.example.com,www2.example.com,*.example.com"
	config.PkiPrivateKey = keyFile.Name()
	config.PkiCertificate = certFile.Name()
	CertFetcher(client, config)
	multipleDomainCertNoChainData, err := ioutil.ReadFile(certFile.Name())
	if err != nil {
		t.Fatal(err)
	}
	keyFileData, err := ioutil.ReadFile(keyFile.Name())
	if err != nil {
		t.Fatal(err)
	}
	assert.Equal(t, []byte(testPkiMultipleDomainCertificateNoChain), multipleDomainCertNoChainData)
	assert.Equal(t, []byte(testPkiMultipleDomainPrivateKey), keyFileData)

	config.PkiUseCaChain = true
	CertFetcher(client, config)
	multipleDomainCertWithChainData, err := ioutil.ReadFile(certFile.Name())
	if err != nil {
		t.Fatal(err)
	}
	assert.Equal(t, []byte(testPkiMultipleDomainCertificateWithChain), multipleDomainCertWithChainData)
}

func TestCertIssuanceErrors(t *testing.T) {
	var config cfg.Config

	ts := httptest.NewTLSServer(testHandler())
	defer ts.Close()
	client, err := testhelpers.GetTestClient(ts.URL)
	if err != nil {
		t.Fatal(err)
	}

	keyFile, err := ioutil.TempFile(os.TempDir(), "pki-test-")
	if err != nil {
		t.Fatal(err)
	}
	defer os.Remove(keyFile.Name())

	certFile, err := ioutil.TempFile(os.TempDir(), "pki-test-")
	if err != nil {
		t.Fatal(err)
	}
	defer os.Remove(certFile.Name())

	config.PkiIssuer = "test_intermediate_authority_T2"
	config.PkiRole = "wrong-role"
	config.PkiDomains = "www.example.com"
	config.PkiPrivateKey = keyFile.Name()
	config.PkiCertificate = certFile.Name()
	assert.Panics(t, func() { CertFetcher(client, config) })

	config.PkiRole = "correct-role"
	err = os.Chmod(keyFile.Name(), 0444)
	if err != nil {
		t.Fatal(err)
	}
	assert.Panics(t, func() { CertFetcher(client, config) })

	err = os.Chmod(certFile.Name(), 0444)
	if err != nil {
		t.Fatal(err)
	}
	assert.Panics(t, func() { CertFetcher(client, config) })
}
